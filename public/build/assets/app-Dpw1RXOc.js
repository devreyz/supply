import{a as ye,H as q}from"./vendor-CCKSAvAt.js";window.axios=ye;window.axios.defaults.headers.common["X-Requested-With"]="XMLHttpRequest";class H{constructor(e="spa_app",t=1){this.dbName=e,this.version=t,this.db=null,this._stores=new Map,this._migrations=[],this._observers=new Map,this._pendingUpgrade=null}observe(e,t){return this._observers.has(e)||this._observers.set(e,new Set),this._observers.get(e).add(t),()=>this._observers.get(e).delete(t)}_notify(e,t,s){this._observers.has(e)&&this._observers.get(e).forEach(n=>{try{n({table:e,type:t,data:s,timestamp:new Date})}catch(o){console.error(`Erro no observer de ${e}:`,o)}})}async defineTable(e,t={}){this._stores.set(e,{keyPath:t.keyPath||"id",autoIncrement:t.autoIncrement!==!1,indexes:t.indexes||[],softDelete:t.softDelete||!1,timestamps:t.timestamps!==!1});try{if(this.db&&!this.db.objectStoreNames.contains(e)){if(this._pendingUpgrade&&(await this._pendingUpgrade,this.db.objectStoreNames.contains(e)))return this;this._pendingUpgrade=(async()=>{this.db.close(),this.version=(this.db.version||1)+1,await this.init(),this._pendingUpgrade=null})(),await this._pendingUpgrade}}catch(s){console.error("Erro ao criar store automaticamente:",s)}return this}migration(e){return this._migrations.push(e),this}async init(){return new Promise((e,t)=>{const s=()=>{const n=indexedDB.open(this.dbName,this.version);n.onerror=()=>{const o=n.error;if(o&&(o.name==="VersionError"||/less than the existing version/i.test(String(o.message)))){const a=indexedDB.open(this.dbName);a.onsuccess=()=>{try{const r=a.result.version||1;a.result.close(),this.version=r+1,s()}catch(r){t(new Error(`Erro ao recuperar vers√£o atual do DB: ${r}`))}},a.onerror=()=>{t(new Error(`Erro ao recuperar vers√£o atual do DB: ${a.error}`))};return}t(new Error(`Erro ao abrir IndexedDB: ${o}`))},n.onsuccess=()=>{this.db=n.result;const o=this.validateSchema();o.length>0&&console.warn(`‚ö†Ô∏è Tabelas faltando no IndexedDB: ${o.join(", ")}`),console.log(`üíæ IndexedDB "${this.dbName}" conectado`),e(this)},n.onupgradeneeded=o=>{const a=o.target.result;this._stores.forEach((c,d)=>{let l;a.objectStoreNames.contains(d)?l=o.currentTarget.transaction.objectStore(d):(l=a.createObjectStore(d,{keyPath:c.keyPath,autoIncrement:c.autoIncrement}),console.log(`üì¶ Tabela criada: ${d}`)),c.indexes.forEach(u=>{const h=typeof u=="string"?u:u.name,m=typeof u=="string"?u:u.keyPath||u.name;if(!l.indexNames.contains(h)){const w=typeof u=="object"?{unique:u.unique||!1,multiEntry:u.multiEntry||!1}:{};l.createIndex(h,m,w)}}),c.timestamps&&(l.indexNames.contains("createdAt")||l.createIndex("createdAt","createdAt",{unique:!1}),l.indexNames.contains("updatedAt")||l.createIndex("updatedAt","updatedAt",{unique:!1})),c.softDelete&&(l.indexNames.contains("deletedAt")||l.createIndex("deletedAt","deletedAt",{unique:!1}))}),["_settings","_queue","_cache"].forEach(c=>{a.objectStoreNames.contains(c)||a.createObjectStore(c,{keyPath:"id",autoIncrement:!0})}),this._migrations.forEach(c=>{try{c(a,o)}catch(d){console.error("Erro na migra√ß√£o:",d)}})}};s()})}table(e){const t=this._stores.get(e)||{};return new J(this,e,t)}validateSchema(){if(!this.db)return[];const e=Array.from(this._stores.keys()),t=Array.from(this.db.objectStoreNames);return e.filter(s=>!t.includes(s))}from(e){return this.table(e)}async transaction(e,t,s){return new Promise((n,o)=>{const a=this.db.transaction(e,t);a.oncomplete=()=>n(),a.onerror=()=>o(a.error),a.onabort=()=>o(new Error("Transa√ß√£o abortada"));try{s(a)}catch(r){a.abort(),o(r)}})}async clear(){const e=Array.from(this.db.objectStoreNames);for(const t of e)await this.table(t).truncate()}async delete(){return this.db.close(),new Promise((e,t)=>{const s=indexedDB.deleteDatabase(this.dbName);s.onsuccess=()=>e(),s.onerror=()=>t(s.error)})}async export(){const e={},t=Array.from(this.db.objectStoreNames);for(const s of t)e[s]=await this.table(s).all();return JSON.stringify(e,null,2)}async import(e){const t=JSON.parse(e);for(const[s,n]of Object.entries(t))if(this.db.objectStoreNames.contains(s)){await this.table(s).truncate();for(const o of n)await this.table(s).insert(o)}}}class J{constructor(e,t,s={}){this.orm=e,this.db=e.db,this.storeName=t,this.config=s,this._where=null,this._orderBy=null,this._orderDir="asc",this._limit=null,this._offset=0,this._withTrashed=!1,this._onlyTrashed=!1}withTrashed(){return this._withTrashed=!0,this}onlyTrashed(){return this._onlyTrashed=!0,this._withTrashed=!0,this}where(e,t){return typeof e=="function"?this._where=e:this._where=s=>s[e]===t,this}whereIn(e,t){return this._where=s=>t.includes(s[e]),this}whereNot(e,t){return this._where=s=>s[e]!==t,this}whereBetween(e,t,s){return this._where=n=>n[e]>=t&&n[e]<=s,this}whereNull(e){return this._where=t=>t[e]===null||t[e]===void 0,this}whereNotNull(e){return this._where=t=>t[e]!==null&&t[e]!==void 0,this}latest(e="createdAt"){return this.orderBy(e,"desc")}oldest(e="createdAt"){return this.orderBy(e,"asc")}async search(e,t=[]){const s=await this.all(),n=e.toLowerCase();return s.filter(o=>t.some(a=>String(o[a]||"").toLowerCase().includes(n)))}async pluck(e){return(await this.all()).map(s=>s[e])}async last(){const e=await this.all();return e[e.length-1]||null}async random(){const e=await this.all();return e.length===0?null:e[Math.floor(Math.random()*e.length)]}async sum(e){return(await this.all()).reduce((s,n)=>s+(Number(n[e])||0),0)}async avg(e){const t=await this.all();return t.length===0?0:await this.sum(e)/t.length}async min(e){const t=await this.all();return t.length===0?null:Math.min(...t.map(s=>Number(s[e])||0))}async max(e){const t=await this.all();return t.length===0?null:Math.max(...t.map(s=>Number(s[e])||0))}orderBy(e,t="asc"){return this._orderBy=e,this._orderDir=t,this}limit(e){return this._limit=e,this}offset(e){return this._offset=e,this}async all(){return new Promise((e,t)=>{const o=this.db.transaction(this.storeName,"readonly").objectStore(this.storeName).getAll();o.onsuccess=()=>{let a=o.result||[];if(this.config.softDelete&&!this._withTrashed?a=a.filter(r=>!r.deletedAt):this.config.softDelete&&this._onlyTrashed&&(a=a.filter(r=>!!r.deletedAt)),this._where&&(a=a.filter(this._where)),this._orderBy&&a.sort((r,c)=>{const d=r[this._orderBy],l=c[this._orderBy];return d<l?this._orderDir==="asc"?-1:1:d>l?this._orderDir==="asc"?1:-1:0}),this._offset>0||this._limit!==null){const r=this._limit!==null?this._offset+this._limit:void 0;a=a.slice(this._offset,r)}e(a)},o.onerror=()=>t(o.error)})}async first(){return this._limit=1,(await this.all())[0]||null}async find(e){return new Promise((t,s)=>{const a=this.db.transaction(this.storeName,"readonly").objectStore(this.storeName).get(e);a.onsuccess=()=>{const r=a.result||null;if(r&&this.config.softDelete&&!this._withTrashed&&r.deletedAt)return t(null);t(r)},a.onerror=()=>s(a.error)})}async count(){return this._where?(await this.all()).length:new Promise((e,t)=>{const o=this.db.transaction(this.storeName,"readonly").objectStore(this.storeName).count();o.onsuccess=()=>e(o.result),o.onerror=()=>t(o.error)})}async exists(e){return await this.find(e)!==null}async insert(e){return new Promise((t,s)=>{const o=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName),a={...e,createdAt:e.createdAt||new Date().toISOString(),updatedAt:new Date().toISOString()},r=o.add(a);r.onsuccess=()=>{a.id=r.result,this.orm._notify(this.storeName,"insert",a),t(a)},r.onerror=()=>s(r.error)})}async insertMany(e){const t=[];for(const s of e){const n=await this.insert(s);t.push(n)}return t}async update(e,t){return new Promise(async(s,n)=>{const o=await this.find(e);if(!o){n(new Error(`Registro n√£o encontrado: ${e}`));return}const r=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName),c={...o,...t,id:e,updatedAt:new Date().toISOString()},d=r.put(c);d.onsuccess=()=>{this.orm._notify(this.storeName,"update",c),s(c)},d.onerror=()=>n(d.error)})}async upsert(e){return e.id&&await this.exists(e.id)?this.update(e.id,e):this.insert(e)}async firstOrCreate(e,t={}){const s=await this.where(n=>Object.entries(e).every(([o,a])=>n[o]===a)).first();return s||this.insert({...e,...t})}async updateOrCreate(e,t={}){const s=await this.where(n=>Object.entries(e).every(([o,a])=>n[o]===a)).first();return s?this.update(s.id,t):this.insert({...e,...t})}async chunk(e,t){let s=1,n=!0;for(;n;){const{data:o,pagination:a}=await this.paginate(s,e);o.length>0&&await t(o,s),n=a.hasMore,s++}}async delete(e){if(this.config.softDelete){const t=await this.update(e,{deletedAt:new Date().toISOString()});return this.orm._notify(this.storeName,"delete",{id:e,soft:!0}),t}return new Promise((t,s)=>{const a=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);a.onsuccess=()=>{this.orm._notify(this.storeName,"delete",{id:e,soft:!1}),t(!0)},a.onerror=()=>s(a.error)})}async restore(e){return this.config.softDelete?this.update(e,{deletedAt:null}):!1}async forceDelete(e){return new Promise((t,s)=>{const a=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).delete(e);a.onsuccess=()=>t(!0),a.onerror=()=>s(a.error)})}async deleteWhere(){if(!this._where)throw new Error("deleteWhere requer uma condi√ß√£o where()");const e=await this.all();for(const t of e)await this.delete(t.id);return e.length}async truncate(){return new Promise((e,t)=>{const o=this.db.transaction(this.storeName,"readwrite").objectStore(this.storeName).clear();o.onsuccess=()=>{this.orm._notify(this.storeName,"truncate",null),e(!0)},o.onerror=()=>t(o.error)})}async findByIndex(e,t){return new Promise((s,n)=>{const c=this.db.transaction(this.storeName,"readonly").objectStore(this.storeName).index(e).getAll(t);c.onsuccess=()=>s(c.result||[]),c.onerror=()=>n(c.error)})}async increment(e,t,s=1){const n=await this.find(e);return n?(n[t]=(n[t]||0)+s,this.update(e,n)):null}async decrement(e,t,s=1){return this.increment(e,t,-s)}async paginate(e=1,t=10){const s=await this.count(),n=Math.ceil(s/t);return this._offset=(e-1)*t,this._limit=t,{data:await this.all(),pagination:{page:e,perPage:t,total:s,totalPages:n,hasMore:e<n}}}}typeof window<"u"&&(window.IndexedDBORM=H,window.QueryBuilder=J);class N{constructor(e="spa_"){this.prefix=e,this._cache=new Map,this._watchers=new Map}_key(e){return`${this.prefix}${e}`}get(e,t=null){if(this._cache.has(e))return this._cache.get(e);try{const s=localStorage.getItem(this._key(e));if(s===null)return t;const n=JSON.parse(s);return this._cache.set(e,n),n}catch(s){return console.warn(`Erro ao ler localStorage[${e}]:`,s),t}}set(e,t){try{const s=JSON.stringify(t);return localStorage.setItem(this._key(e),s),this._cache.set(e,t),this._notify(e,t),!0}catch(s){return console.error(`Erro ao salvar localStorage[${e}]:`,s),!1}}remove(e){return localStorage.removeItem(this._key(e)),this._cache.delete(e),this._notify(e,null),!0}has(e){return localStorage.getItem(this._key(e))!==null}keys(){const e=[];for(let t=0;t<localStorage.length;t++){const s=localStorage.key(t);s.startsWith(this.prefix)&&e.push(s.substring(this.prefix.length))}return e}all(){const e={};return this.keys().forEach(t=>{e[t]=this.get(t)}),e}clear(){return this.keys().forEach(e=>{this.remove(e)}),this._cache.clear(),!0}async remember(e,t){if(this.has(e))return this.get(e);const s=typeof t=="function"?await t():t;return this.set(e,s),s}increment(e,t=1){const s=this.get(e,0),n=(Number(s)||0)+t;return this.set(e,n),n}decrement(e,t=1){return this.increment(e,-t)}push(e,t){const s=this.get(e,[]);if(!Array.isArray(s))throw new Error(`${e} n√£o √© um array`);return s.push(t),this.set(e,s),s}pop(e){const t=this.get(e,[]);if(!Array.isArray(t))throw new Error(`${e} n√£o √© um array`);const s=t.pop();return this.set(e,t),s}setNested(e,t,s){const n=this.get(e,{}),o=t.split(".");let a=n;for(let r=0;r<o.length-1;r++)o[r]in a||(a[o[r]]={}),a=a[o[r]];return a[o[o.length-1]]=s,this.set(e,n),n}getNested(e,t,s=null){const n=this.get(e,{}),o=t.split(".");let a=n;for(const r of o)if(a&&typeof a=="object"&&r in a)a=a[r];else return s;return a}watch(e,t){return this._watchers.has(e)||this._watchers.set(e,new Set),this._watchers.get(e).add(t),()=>{const s=this._watchers.get(e);s&&s.delete(t)}}_notify(e,t){const s=this._watchers.get(e);if(s){const n=this._cache.get(e);s.forEach(o=>{try{o(t,n)}catch(a){console.error("Erro no watcher:",a)}})}}setWithExpiry(e,t,s){const n={value:t,expiry:Date.now()+s*1e3};return this.set(e,n)}getWithExpiry(e,t=null){const s=this.get(e);return s?s.expiry&&Date.now()>s.expiry?(this.remove(e),t):s.value:t}export(){return JSON.stringify(this.all(),null,2)}import(e){const t=JSON.parse(e);return Object.entries(t).forEach(([s,n])=>{this.set(s,n)}),!0}size(){let e=0;return this.keys().forEach(t=>{const s=localStorage.getItem(this._key(t));s&&(e+=s.length*2)}),e}isNearLimit(e=.9){const t=this.size(),s=5*1024*1024;return t>=s*e}}const ve=new N("spa_");typeof window<"u"&&(window.LocalStorageORM=N,window.Storage=ve);const f={PENDING:"pending",PROCESSING:"processing",COMPLETED:"completed",FAILED:"failed",CANCELLED:"cancelled"};class G{constructor(e){this.db=e,this.storeName="_queue",this.handlers=new Map,this.actions=this.handlers,this.isProcessing=!1,this.retryAttempts=3,this.retryDelay=1e3,this._listeners=new Map}async init(){return console.log("üìã Job Queue inicializada"),await this._cleanupStuckJobs(),typeof window<"u"&&(window.addEventListener("online",()=>{console.log("üåê Conex√£o restaurada. Processando fila..."),this.processNext()}),"serviceWorker"in navigator&&navigator.serviceWorker.addEventListener("message",e=>{e.data&&e.data.type==="SYNC_TRIGGERED"&&(console.log("üîÑ Sync disparado pelo SW"),this.processNext())}),document.addEventListener("visibilitychange",()=>{document.visibilityState==="visible"&&this.processNext()})),setInterval(()=>this.processNext(),3e4),navigator.onLine&&this.processNext(),this}async _cleanupStuckJobs(){const e=await this.processing();for(const t of e)console.warn(`üìã Recuperando job travado: #${t.id}`),await this.db.table(this.storeName).update(t.id,{status:f.PENDING,error:"Interrompido (Browser fechado ou erro fatal)",updatedAt:new Date().toISOString()})}defineAction(e,t){return this.handlers.set(e,t),console.log(`üìã A√ß√£o registrada: ${e}`),this}defineActions(e){return Object.entries(e).forEach(([t,s])=>{this.defineAction(t,s)}),this}register(e,t){return this.defineAction(e,t)}async dispatch(e,t={},s={}){return this.add(e,t,s)}async add(e,t,s={}){if(s.unique){const a=await this.db.table(this.storeName).where(r=>r.type===e&&r.status===f.PENDING).first();if(a&&JSON.stringify(a.data)===JSON.stringify(t))return console.log(`üìã Job duplicado ignorado: ${e}`),a.id}const n={type:e,data:t,status:f.PENDING,attempts:0,maxAttempts:s.maxAttempts||this.retryAttempts,priority:s.priority||0,delay:s.delay||0,timeout:s.timeout||0,deleteOnComplete:s.deleteOnComplete!==!1,createdAt:new Date().toISOString(),scheduledAt:s.delay?new Date(Date.now()+s.delay).toISOString():new Date().toISOString(),error:null,result:null,progress:0},o=await this.db.table(this.storeName).insert(n);return this._emit("job:added",o),console.log(`üìã Job adicionado: ${e} #${o.id}`),navigator.onLine&&!s.delay&&this.processNext(),o.id}async setProgress(e,t){const s=await this.db.table(this.storeName).update(e,{progress:Math.min(100,Math.max(0,t))});return this._emit("job:progress",s),s}async all(){return this.db.table(this.storeName).orderBy("createdAt","desc").all()}async pending(){return this.db.table(this.storeName).where("status",f.PENDING).orderBy("priority","desc").all()}async processing(){return this.db.table(this.storeName).where("status",f.PROCESSING).all()}async completed(){return this.db.table(this.storeName).where("status",f.COMPLETED).orderBy("updatedAt","desc").all()}async failed(){return this.db.table(this.storeName).where("status",f.FAILED).all()}async get(e){return this.db.table(this.storeName).find(e)}async count(e=null){return e?this.db.table(this.storeName).where("status",e).count():this.db.table(this.storeName).count()}async stats(){const e=await this.all();return{total:e.length,pending:e.filter(t=>t.status===f.PENDING).length,processing:e.filter(t=>t.status===f.PROCESSING).length,completed:e.filter(t=>t.status===f.COMPLETED).length,failed:e.filter(t=>t.status===f.FAILED).length,cancelled:e.filter(t=>t.status===f.CANCELLED).length}}async remove(e){const t=await this.get(e);return t?(await this.db.table(this.storeName).delete(e),this._emit("job:removed",t),console.log(`üìã Job removido: #${e}`),!0):!1}async complete(e,t=null,s=!1){const n=await this.db.table(this.storeName).update(e,{status:f.COMPLETED,result:t,completedAt:new Date().toISOString()});return this._emit("job:completed",n),console.log(`‚úÖ Job completado: #${e}`),s&&await this.remove(e),n}async fail(e,t){const s=await this.get(e);if(!s)return null;const n={error:t,attempts:s.attempts+1};s.attempts+1<s.maxAttempts?(n.status=f.PENDING,n.scheduledAt=new Date(Date.now()+this.retryDelay*(s.attempts+1)).toISOString()):(n.status=f.FAILED,n.failedAt=new Date().toISOString());const o=await this.db.table(this.storeName).update(e,n);return o.status===f.FAILED?(this._emit("job:failed",o),console.error(`‚ùå Job falhou: #${e} - ${t}`)):(this._emit("job:retry",o),console.warn(`üîÑ Job ser√° reenviado: #${e} (tentativa ${o.attempts}/${s.maxAttempts})`)),o}async cancel(e){const t=await this.db.table(this.storeName).update(e,{status:f.CANCELLED,cancelledAt:new Date().toISOString()});return this._emit("job:cancelled",t),console.log(`üö´ Job cancelado: #${e}`),t}async retry(e){const t=await this.db.table(this.storeName).update(e,{status:f.PENDING,attempts:0,error:null,scheduledAt:new Date().toISOString()});return this._emit("job:retry",t),console.log(`üîÑ Job reagendado: #${e}`),navigator.onLine&&this.processNext(),t}async retryAll(){const e=await this.failed();for(const t of e)await this.retry(t.id);return e.length}async sync(){return console.log("üìã Sincroniza√ß√£o manual disparada"),this.processAll()}async processNext(){if(this.isProcessing||!navigator.onLine)return;const e=await this.db.table(this.storeName).where(t=>t.status===f.PENDING&&new Date(t.scheduledAt)<=new Date).orderBy("priority","desc").first();e&&(await this._processJob(e),setTimeout(()=>this.processNext(),100))}async processAll(){if(!navigator.onLine){console.warn("üìã Sem conex√£o. Jobs ser√£o processados quando online.");return}console.log("üìã Processando todos os jobs pendentes...");const e=await this.pending();for(const t of e)await this._processJob(t);return console.log(`üìã ${e.length} jobs processados`),e.length}async process(e){const t=await this.db.table(this.storeName).where(s=>s.type===e&&s.status===f.PENDING).all();for(const s of t)await this._processJob(s);return t.length}async _processJob(e){const t=this.handlers.get(e.type);if(!t){console.error(`‚ùå A√ß√£o n√£o encontrada: ${e.type}`),await this.fail(e.id,"A√ß√£o n√£o encontrada");return}await this.db.table(this.storeName).update(e.id,{status:f.PROCESSING,startedAt:new Date().toISOString()}),this.isProcessing=!0,this._emit("job:processing",e);try{let s;if(e.timeout>0){const n=new Promise((o,a)=>setTimeout(()=>a(new Error("Job Timeout")),e.timeout));s=await Promise.race([t(e.data,e),n])}else s=await t(e.data,e);e.deleteOnComplete?await this.complete(e.id,s,!0):await this.complete(e.id,s,!1)}catch(s){await this.fail(e.id,s.message||String(s))}finally{this.isProcessing=!1}}async clearCompleted(e=0){const t=await this.completed(),s=Date.now()-e;let n=0;for(const o of t)new Date(o.completedAt||o.updatedAt).getTime()<s&&(await this.remove(o.id),n++);return console.log(`üìã ${n} jobs completados removidos`),n}async clear(){await this.db.table(this.storeName).truncate(),console.log("üìã Fila limpa"),this._emit("queue:cleared")}on(e,t){return this._listeners.has(e)||this._listeners.set(e,new Set),this._listeners.get(e).add(t),()=>this.off(e,t)}off(e,t){const s=this._listeners.get(e);s&&s.delete(t)}_emit(e,t){const s=this._listeners.get(e);s&&s.forEach(n=>{try{n(t)}catch(o){console.error("Erro no listener:",o)}}),document.dispatchEvent(new CustomEvent(`spa:${e}`,{detail:t}))}}typeof window<"u"&&(window.JobStatus=f,window.JobQueue=G);class U{constructor(e={},t={}){e&&typeof e.modal=="function"?(this.spa=e,this.options={showBanner:!0,bannerDelay:5e3,bannerDismissKey:"spa_pwa_dismissed",serviceWorker:"./service-worker.js",...t}):(this.spa=null,this.options={showBanner:!0,bannerDelay:5e3,bannerDismissKey:"spa_pwa_dismissed",serviceWorker:"./service-worker.js",...e}),this.deferredPrompt=null,this.isInstalled=!1,this.isStandalone=!1,this.isShowingPrompt=!1,this.hasAttemptedPrompt=!1,this.installationPending=!1,this.promptTimeout=null,this._init()}async _showIOSInstallModal(){if(this.isInstalled||this.isShowingPrompt)return;this.isShowingPrompt=!0;const e=this.options.installHtml||`
    <style>
        .ios-wrapper {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Text", "Segoe UI", Roboto, sans-serif;
            display: flex;
            flex-direction: column;
            gap: 1.25rem; /* Aumentei levemente o gap geral */
            color: #1c1c1e;
            margin-bottom: 1.5rem; /* Margem inferior solicitada */
        }

        /* --- Header: Identidade do App --- */
        .ios-hero {
            display: flex;
            align-items: center;
            gap: 1rem;
        }
        .ios-app-icon {
            width: 3.5rem;
            height: 3.5rem;
            border-radius: 0.8rem;
            background: linear-gradient(135deg, #ea580c, #c2410c);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            box-shadow: 0 4px 12px rgba(234, 88, 12, 0.3);
            flex-shrink: 0;
        }
        .ios-hero-content h3 {
            margin: 0;
            font-size: 1.1rem;
            font-weight: 700;
            letter-spacing: -0.02em;
        }
        .ios-hero-content p {
            margin: 0.2rem 0 0;
            font-size: 0.85rem;
            color: #8e8e93;
        }

        /* --- Faixa de Recursos (Mini Bento) --- */
        .ios-features-strip {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            background: #F2F2F7;
            border-radius: 0.8rem;
            padding: 0.8rem 0.5rem;
            text-align: center;
        }
        .ios-feature-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.3rem;
            border-right: 1px solid rgba(0,0,0,0.08);
        }
        .ios-feature-item:last-child {
            border-right: none;
        }
        .ios-feat-icon {
            color: #007AFF;
            background: rgba(0, 122, 255, 0.1);
            padding: 0.35rem;
            border-radius: 50%;
        }
        .ios-feat-title {
            font-size: 0.7rem;
            font-weight: 600;
            margin-top: 0.1rem;
        }
        .ios-feat-desc {
            font-size: 0.65rem;
            color: #636366;
        }

        /* --- Instru√ß√µes --- */
        .ios-steps-container {
            display: flex;
            flex-direction: column;
            gap: 0.6rem;
        }
        .ios-step-row {
            display: flex;
            align-items: center;
            gap: 0.8rem;
            padding: 0.6rem 0;
            border-bottom: 1px solid #E5E5EA;
        }
        .ios-step-row:last-child {
            border-bottom: none;
        }
        .ios-step-highlight {
            font-weight: 700;
            color: #000;
        }

        /* --- Finaliza√ß√£o --- */
        .ios-footer-note {
            text-align: center;
            font-size: 0.8rem;
            color: #8e8e93;
            background: #fff;
            padding-top: 0.5rem;
        }
    </style>

    <div class="ios-wrapper">
        
        <div class="ios-hero">
            <div class="ios-app-icon">
                <i data-lucide="smartphone" style="width: 1.6rem; height: 1.6rem;"></i>
            </div>
            <div class="ios-hero-content">
                <h3>Instale o Tymely</h3>
                <p>Tenha a melhor experi√™ncia direto na sua tela inicial.</p>
            </div>
        </div>

        <div class="ios-features-strip">
            <div class="ios-feature-item">
                <div class="ios-feat-icon">
                    <i data-lucide="zap" style="width: 1rem; height: 1rem;"></i>
                </div>
                <span class="ios-feat-title">R√°pido</span>
                <span class="ios-feat-desc">Instant√¢neo</span>
            </div>
            <div class="ios-feature-item">
                <div class="ios-feat-icon" style="color: #34C759; background: rgba(52, 199, 89, 0.1);">
                    <i data-lucide="wifi-off" style="width: 1rem; height: 1rem;"></i>
                </div>
                <span class="ios-feat-title">Offline</span>
                <span class="ios-feat-desc">Sem net</span>
            </div>
            <div class="ios-feature-item">
                <div class="ios-feat-icon" style="color: #FF9500; background: rgba(255, 149, 0, 0.1);">
                    <i data-lucide="feather" style="width: 1rem; height: 1rem;"></i>
                </div>
                <span class="ios-feat-title">Leve</span>
                <span class="ios-feat-desc">Otimizado</span>
            </div>
        </div>

        <div class="ios-steps-container">
            <div style="font-size: 0.75rem; font-weight: 600; color: #8E8E93; text-transform: uppercase; margin-bottom: 0.25rem; letter-spacing: 0.05em;">Como Adicionar</div>
            
            <div class="ios-step-row">
                <i data-lucide="share" style="color: #007AFF; width: 1.2rem; height: 1.2rem;"></i>
                <span style="font-size: 0.9rem; font-weight: 500;">Toque em <span class="ios-step-highlight">Compartilhar</span> na barra.</span>
            </div>
            
            <div class="ios-step-row">
                <i data-lucide="plus-square" style="color: #636366; width: 1.2rem; height: 1.2rem;"></i>
                <span style="font-size: 0.9rem; font-weight: 500;">Escolha <span class="ios-step-highlight">Adicionar √† Tela de In√≠cio</span>.</span>
            </div>
        </div>

        <div class="ios-footer-note">
            <span>Pronto! O app aparecer√° nos seus apps.</span>
        </div>

    </div>
    `;try{const t={title:this.options.installTitle||"Instalar Aplicativo",html:e,type:"custom",closeOnBackdrop:!1,width:this.options.installWidth||"420px",customButtons:[{text:this.options.cancelText||"Fechar",class:"btn btn-outline",value:"cancel"},{text:this.options.okText||"Entendi",class:"btn btn-primary",value:"ok"}]},s=await this.spa.modal(t);this.isShowingPrompt=!1,this._dismiss()}catch(t){this.isShowingPrompt=!1,console.error("üì± PWA: Falha ao abrir modal iOS",t)}}_init(){if(this.isStandalone=window.matchMedia("(display-mode: standalone)").matches||window.navigator.standalone===!0,this.isStandalone){this.isInstalled=!0,console.log("üì± PWA: App instalado (standalone)");return}window.addEventListener("beforeinstallprompt",e=>{e.preventDefault(),this.deferredPrompt=e,console.log("üì± PWA: Prompt de instala√ß√£o dispon√≠vel"),this._emit("pwa:installable"),!(this.hasAttemptedPrompt||this.isShowingPrompt||this.isInstalled)&&(this.promptTimeout&&clearTimeout(this.promptTimeout),this.options.showBanner&&!this._wasDismissed()&&(this.hasAttemptedPrompt=!0,this.promptTimeout=setTimeout(()=>{this.isShowingPrompt||this.isInstalled||(this.spa&&typeof this.spa.modal=="function"?this._showInstallModal():this._showBanner())},this.options.bannerDelay)))}),window.addEventListener("appinstalled",()=>{this.isInstalled=!0,this.deferredPrompt=null,this.promptTimeout&&clearTimeout(this.promptTimeout),this.isShowingPrompt=!1,console.log("üì± PWA: App instalado!"),this._emit("pwa:installed"),this._hideBanner(),this.installationPending=!1;try{this.spa&&typeof this.spa.toastSuccess=="function"&&this.spa.toastSuccess("App instalado","A aplica√ß√£o foi adicionada √† sua tela inicial")}catch{}}),this._registerServiceWorker();try{this.options.showBanner&&!this._wasDismissed()&&!this.isInstalled&&!this.hasAttemptedPrompt&&this._detectPlatform()==="ios"&&(this.hasAttemptedPrompt=!0,this.promptTimeout&&clearTimeout(this.promptTimeout),this.promptTimeout=setTimeout(()=>{this.isShowingPrompt||this.isInstalled||this._showIOSInstallModal()},this.options.bannerDelay))}catch{}}async _registerServiceWorker(){if(!("serviceWorker"in navigator)){console.warn("üì± PWA: Service Worker n√£o suportado");return}try{const e={};this.options.scope&&(e.scope=this.options.scope);const t=await navigator.serviceWorker.register(this.options.serviceWorker||"./service-worker.js",e);console.log("üì± PWA: Service Worker registrado",t.scope),t.addEventListener("updatefound",()=>{const s=t.installing;s.addEventListener("statechange",()=>{s.state==="installed"&&navigator.serviceWorker.controller&&(console.log("üì± PWA: Nova vers√£o dispon√≠vel"),this._emit("pwa:update-available",t))})}),navigator.serviceWorker.addEventListener("message",s=>{s.data.type==="SYNC_TRIGGERED"&&this._emit("pwa:sync")})}catch(e){console.error("üì± PWA: Erro ao registrar SW:",e)}}showInstallPrompt(){if(this.isInstalled){console.log("üì± PWA: J√° instalado, ignorando prompt");return}if(this._detectPlatform()==="ios")return this._showIOSInstallModal();this.deferredPrompt?this._showInstallModal():(console.warn("üì± PWA: Instalador iniciado manualmente, mas deferredPrompt ainda n√£o foi capturado."),this._showBanner())}canInstall(){return this.deferredPrompt!==null&&!this.isInstalled}_detectPlatform(){const t=(navigator.userAgent||navigator.vendor||window.opera||"").toLowerCase();return/iphone|ipad|ipod/.test(t)||t.includes("mac")&&"ontouchend"in document?"ios":/android/.test(t)?"android":/windows/.test(t)?"windows":/mac os x/.test(t)?"mac":"desktop"}async promptInstall(){if(!this.deferredPrompt)return console.warn("üì± PWA: Prompt de instala√ß√£o n√£o dispon√≠vel"),!1;this.deferredPrompt.prompt();const{outcome:e}=await this.deferredPrompt.userChoice;return console.log(`üì± PWA: Usu√°rio ${e==="accepted"?"aceitou":"recusou"} instala√ß√£o`),this.deferredPrompt=null,e==="accepted"}async _showInstallModal(){if(this.isInstalled||!this.canInstall()||this.isShowingPrompt)return;if(this.isShowingPrompt=!0,this._detectPlatform()==="ios")return this.isShowingPrompt=!1,this._showIOSInstallModal();const t=this.options.installHtml||`
    <style>
        /* Anima√ß√£o suave do Gradiente de Fundo */
        @keyframes premiumGradient {
            0% { background-position: 0% 50%; }
            50% { background-position: 100% 50%; }
            100% { background-position: 0% 50%; }
        }
        
        /* Anima√ß√£o de Flutua√ß√£o (Floating) */
        @keyframes premiumFloat {
            0%, 100% { transform: translateY(0) rotate(-3deg); }
            50% { transform: translateY(-8px) rotate(2deg); }
        }

        .pwa-bento-container {
            font-family: -apple-system, BlinkMacSystemFont, "SF Pro Display", "Segoe UI", Roboto, sans-serif;
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 0.75rem;
            margin: 1.5rem 0;
        }

        /* --- Hero Card (Card Principal) --- */
        .pwa-hero-card {
            grid-column: span 2;
            padding: 1.5rem;
            border-radius: 1.25rem;
            /* Gradiente Premium Sky Blue */
            background: linear-gradient(120deg, #e0f2fe, #bae6fd, #e0f2fe);
            background-size: 200% 200%;
            animation: premiumGradient 8s ease infinite;
            
            border: 1px solid rgba(14, 165, 233, 0.2);
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 1rem;
            position: relative;
            overflow: hidden;
            box-shadow: 0 10px 30px -10px rgba(14, 165, 233, 0.25);
        }

        /* Elemento Decorativo de Fundo */
        .pwa-hero-bg-blur {
            position: absolute;
            top: -50%;
            right: -20%;
            width: 150px;
            height: 150px;
            background: #0ea5e9;
            filter: blur(80px);
            opacity: 0.15;
            z-index: 0;
        }

        .pwa-hero-content {
            z-index: 1;
            flex: 1;
        }

        .pwa-hero-title {
            margin: 0;
            font-weight: 800;
            font-size: 1.2rem;
            color: #0c4a6e; /* Azul Escuro Profundo */
            letter-spacing: -0.03em;
            line-height: 1.1;
        }

        .pwa-hero-subtitle {
            margin: 0.35rem 0 0;
            font-size: 0.8rem;
            color: #0369a1;
            font-weight: 500;
            line-height: 1.3;
        }

        /* --- Composi√ß√£o dos √çcones Sobrepostos --- */
        .pwa-icon-composition {
            position: relative;
            width: 4rem;
            height: 4rem;
            flex-shrink: 0;
            z-index: 1;
        }

        /* √çcone Traseiro (Smartphone) */
        .pwa-layer-phone {
            position: absolute;
            right: 0;
            bottom: 0;
            width: 2.8rem;
            height: 2.8rem;
            color: #0ea5e9;
            opacity: 0.2;
            transform: rotate(10deg);
        }

        /* √çcone Frontal (Logo Flutuante) */
        .pwa-layer-brand {
            position: absolute;
            left: 0;
            top: 0;
            width: 3rem;
            height: 3rem;
            border-radius: 0.9rem;
            
            /* Gradiente do bot√£o */
            background: linear-gradient(135deg, #0ea5e9 0%, #0284c7 100%);
            
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            
            /* Efeito 3D e Sombra */
            box-shadow: 
                0 8px 20px rgba(14, 165, 233, 0.4),
                inset 0 1px 1px rgba(255,255,255,0.4);
            border: 2px solid rgba(255,255,255,0.6);
            
            animation: premiumFloat 5s ease-in-out infinite;
        }

        /* --- Cards de Benef√≠cios --- */
        .pwa-benefit-card {
            padding: 1rem;
            border-radius: 1rem;
            background: #ffffff;
            border: 1px solid #f1f5f9;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
        }

        .pwa-benefit-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            border-color: #e2e8f0;
        }

        /* Container do √≠cone do benef√≠cio */
        .pwa-icon-box {
            width: 2.2rem;
            height: 2.2rem;
            border-radius: 0.7rem;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .pwa-benefit-text h5 {
            margin: 0;
            font-size: 0.85rem;
            font-weight: 700;
            color: #334155;
        }
        
        .pwa-benefit-text p {
            margin: 0.15rem 0 0;
            font-size: 0.7rem;
            color: #64748b;
            line-height: 1.25;
        }
    </style>

    <div class="pwa-install-bento pwa-bento-container">
        
        <div class="pwa-hero-card">
            <div class="pwa-hero-bg-blur"></div>
            
            <div class="pwa-hero-content">
                <h4 class="pwa-hero-title">Instale o App</h4>
                <p class="pwa-hero-subtitle">Acesso r√°pido, seguro e sem ocupar espa√ßo.</p>
            </div>

            <div class="pwa-icon-composition">
                <div class="pwa-layer-phone">
                    <i data-lucide="smartphone" style="width: 100%; height: 100%;"></i>
                </div>
                <div class="pwa-layer-brand">
                    <i data-lucide="sparkles" style="width: 1.5rem; height: 1.5rem;"></i>
                </div>
            </div>
        </div>
        
        <div class="pwa-benefit-card">
            <div class="pwa-icon-box" style="background: #fffbeb; color: #d97706;">
                <i data-lucide="zap" style="width: 1.1rem; height: 1.1rem;"></i>
            </div>
            <div class="pwa-benefit-text">
                <h5>Instant√¢neo</h5>
                <p>Abre em segundos.</p>
            </div>
        </div>

        <div class="pwa-benefit-card">
            <div class="pwa-icon-box" style="background: #ecfdf5; color: #059669;">
                <i data-lucide="wifi-off" style="width: 1.1rem; height: 1.1rem;"></i>
            </div>
            <div class="pwa-benefit-text">
                <h5>Offline</h5>
                <p>Use sem internet.</p>
            </div>
        </div>

        <div class="pwa-benefit-card">
            <div class="pwa-icon-box" style="background: #f5f3ff; color: #7c3aed;">
                <i data-lucide="feather" style="width: 1.1rem; height: 1.1rem;"></i>
            </div>
            <div class="pwa-benefit-text">
                <h5>Super Leve</h5>
                <p>Poupa mem√≥ria.</p>
            </div>
        </div>

        <div class="pwa-benefit-card">
            <div class="pwa-icon-box" style="background: #fff1f2; color: #e11d48;">
                <i data-lucide="refresh-cw" style="width: 1.1rem; height: 1.1rem;"></i>
            </div>
            <div class="pwa-benefit-text">
                <h5>Atualizado</h5>
                <p>Sync autom√°tico.</p>
            </div>
        </div>
    </div>
    `,s=this.options.installHtml||t;try{const n={title:this.options.installTitle||"Instalar Aplicativo",html:s,type:"custom",closeOnBackdrop:!1,width:this.options.installWidth||"480px",customButtons:[{text:this.options.cancelText||"Agora n√£o",class:"btn btn-outline",value:"cancel"},{text:this.options.installText||"Instalar Agora",class:"btn btn-success",value:"ok"}]},a=await this.spa.modal(n);if(this.isShowingPrompt=!1,a==="ok")if(await this.promptInstall()){this.installationPending=!0;try{this.spa&&typeof this.spa.toastInfo=="function"?this.spa.toastInfo("Instala√ß√£o iniciada","Aguarde enquanto o sistema finaliza a instala√ß√£o."):this.spa&&typeof this.spa.toast=="function"?this.spa.toast("Instala√ß√£o iniciada ‚Äî aguardando confirma√ß√£o."):console.log("üì± PWA: Instala√ß√£o iniciada ‚Äî aguardando evento appinstalled.")}catch{}}else this._dismiss();else this._dismiss()}catch(n){this.isShowingPrompt=!1,console.error("üì± PWA: Falha ao abrir modal de instala√ß√£o, usando banner como fallback",n),this._showBanner()}}_showBanner(){if(this.isInstalled||!this.canInstall()||this.isShowingPrompt)return;this._hideBanner(),this.isShowingPrompt=!0;const e=document.createElement("div");e.id="pwa-install-banner",e.className="pwa-banner",e.innerHTML=`
                <div class="pwa-banner-content">
                    <div class="pwa-banner-icon">üì±</div>
                    <div class="pwa-banner-text">
                        <strong>Instale o App</strong>
                        <span>Adicione √† tela inicial para acesso r√°pido</span>
                    </div>
                </div>
                <div class="pwa-banner-actions">
                    <button class="pwa-banner-dismiss" data-pwa-dismiss>Agora n√£o</button>
                    <button class="pwa-banner-install" data-pwa-install>Instalar</button>
                </div>
            `,document.body.appendChild(e),requestAnimationFrame(()=>{e.classList.add("show")}),e.querySelector("[data-pwa-install]").addEventListener("click",()=>{this.promptInstall(),this._hideBanner()}),e.querySelector("[data-pwa-dismiss]").addEventListener("click",()=>{this._dismiss(),this._hideBanner()})}_hideBanner(){const e=document.getElementById("pwa-install-banner");e?(e.classList.remove("show"),setTimeout(()=>{e.remove(),this.isShowingPrompt=!1},300)):this.isShowingPrompt=!1}_dismiss(){localStorage.setItem(this.options.bannerDismissKey,Date.now().toString())}_wasDismissed(){const e=localStorage.getItem(this.options.bannerDismissKey);if(!e)return!1;const t=30*60*1e3;return Date.now()-parseInt(e)<t}async update(){if(!("serviceWorker"in navigator))return;const e=await navigator.serviceWorker.getRegistration();e&&await e.update()}async sendMessage(e){if(!("serviceWorker"in navigator))return;const t=await navigator.serviceWorker.ready;t.active&&t.active.postMessage(e)}async clearCache(){await this.sendMessage({type:"CLEAR_CACHE"})}async cacheUrls(e){await this.sendMessage({type:"CACHE_URLS",payload:{urls:e}})}_emit(e,t=null){document.dispatchEvent(new CustomEvent(e,{detail:t}))}}typeof window<"u"&&(window.PWAInstaller=U);class V{constructor(e={}){e&&e._registerOverlay?(this.spa=e,this.options={vapidKey:null,defaultIcon:"/img/icon-192.png",defaultBadge:"/img/badge.png"}):(this.spa=null,this.options={vapidKey:null,defaultIcon:"/img/icon-192.png",defaultBadge:"/img/badge.png",...e}),this.permission=Notification.permission,this.subscription=null,this.db=null}isSupported(){return"Notification"in window&&"serviceWorker"in navigator}isEnabled(){return this.permission==="granted"}isDenied(){return this.permission==="denied"}async request(){if(!this.isSupported())return console.warn("üîî Notifica√ß√µes n√£o suportadas"),!1;if(this.isEnabled())return!0;if(this.isDenied())return console.warn("üîî Notifica√ß√µes foram bloqueadas pelo usu√°rio"),!1;try{const e=await Notification.requestPermission();return this.permission=e,e==="granted"?(console.log("üîî Permiss√£o concedida"),this._emit("notifications:granted"),!0):(console.log("üîî Permiss√£o negada"),this._emit("notifications:denied"),!1)}catch(e){return console.error("üîî Erro ao solicitar permiss√£o:",e),!1}}async init(){try{if(!this.spa||(this.db=this.spa.db,!this.db))return;await this.db.defineTable("notifications",{keyPath:"id",autoIncrement:!0,indexes:[{name:"tag",keyPath:"tag"},{name:"read",keyPath:"read"},{name:"createdAt",keyPath:"createdAt"}]}),this.spa&&typeof this.spa._log=="function"&&this.spa._log(2,"üîî NotificationManager: tabela `notifications` pronta")}catch(e){console.error("üîî Erro ao inicializar NotificationManager (DB):",e)}}async store(e={}){if(!this.db)return null;const t={title:e.title||"",body:e.body||"",tag:e.tag||null,data:e.data||null,icon:e.icon||this.options.defaultIcon,read:!!e.read,createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()},s=await this.db.table("notifications").insert(t);return document.dispatchEvent(new CustomEvent("notifications:changed")),s}async list(){return this.db?(await this.db.table("notifications").all()).sort((t,s)=>new Date(s.createdAt)-new Date(t.createdAt)):[]}async markRead(e){if(!this.db)return null;const t=await this.db.table("notifications").find(e);if(!t)return null;t.read=!0,t.updatedAt=new Date().toISOString();const s=await this.db.table("notifications").upsert(t);return document.dispatchEvent(new CustomEvent("notifications:changed")),s}async remove(e){if(!this.db)return null;const t=await this.db.table("notifications").delete(e);return document.dispatchEvent(new CustomEvent("notifications:changed")),t}async show(e,t={}){var n;if(!this.isEnabled()&&!await this.request())return null;const s={icon:t.icon||this.options.defaultIcon,badge:t.badge||this.options.defaultBadge,body:t.body||"",requireInteraction:t.requireInteraction||!1,silent:t.silent||!1,vibrate:t.vibrate||[100,50,100],data:t.data||{},actions:t.actions||[]};t.tag&&(s.tag=t.tag);try{const o=await((n=navigator.serviceWorker)==null?void 0:n.ready);return o?await o.showNotification(e,s):new Notification(e,s),console.log("üîî Notifica√ß√£o mostrada:",e),!0}catch(o){return console.error("üîî Erro ao mostrar notifica√ß√£o:",o),!1}}success(e,t="",s={}){return this.show(e,{body:t,...s})}error(e,t="",s={}){return this.show(e,{body:t,...s})}info(e,t="",s={}){return this.show(e,{body:t,...s})}async subscribePush(){if(!this.options.vapidKey)return console.warn("üîî VAPID key n√£o configurada"),null;if(!this.isEnabled()&&!await this.request())return null;try{const e=await navigator.serviceWorker.ready;let t=await e.pushManager.getSubscription();return t||(t=await e.pushManager.subscribe({userVisibleOnly:!0,applicationServerKey:this._urlBase64ToUint8Array(this.options.vapidKey)})),this.subscription=t,console.log("üîî Push subscription:",t),this._emit("push:subscribed",t),t}catch(e){return console.error("üîî Erro ao assinar push:",e),null}}async unsubscribePush(){var e;if(!this.subscription){const t=await((e=navigator.serviceWorker)==null?void 0:e.ready);this.subscription=await(t==null?void 0:t.pushManager.getSubscription())}return this.subscription?(await this.subscription.unsubscribe(),this.subscription=null,console.log("üîî Push subscription cancelada"),this._emit("push:unsubscribed"),!0):!1}async getSubscription(){var t;const e=await((t=navigator.serviceWorker)==null?void 0:t.ready);return e==null?void 0:e.pushManager.getSubscription()}async closeAll(){var s;const e=await((s=navigator.serviceWorker)==null?void 0:s.ready);if(!e)return;(await e.getNotifications()).forEach(n=>n.close())}async closeByTag(e){var n;const t=await((n=navigator.serviceWorker)==null?void 0:n.ready);if(!t)return;(await t.getNotifications({tag:e})).forEach(o=>o.close())}_urlBase64ToUint8Array(e){const t="=".repeat((4-e.length%4)%4),s=(e+t).replace(/-/g,"+").replace(/_/g,"/"),n=window.atob(s),o=new Uint8Array(n.length);for(let a=0;a<n.length;++a)o[a]=n.charCodeAt(a);return o}_emit(e,t=null){document.dispatchEvent(new CustomEvent(e,{detail:t}))}}typeof window<"u"&&(window.NotificationManager=V);class Y{constructor(e){this.spa=e,this.drawers=new Map,this.isDragging=!1,this.startX=0,this.currentDrawer=null}register(e){const t=document.getElementById(e);if(t&&(this.drawers.set(e,{element:t,isOpen:!1}),this.spa.config.gestures.enabled)){const s=t.querySelector(".drawer-handle")||t;s.addEventListener("touchstart",n=>this._onDragStart(n,e),{passive:!0}),s.addEventListener("touchmove",n=>this._onDragMove(n),{passive:!1}),s.addEventListener("touchend",n=>this._onDragEnd(n))}}open(e){const t=this.drawers.get(e);!t||t.isOpen||(t.element.classList.add("open"),t.isOpen=!0,this.spa._registerOverlay(`drawer-${e}`))}close(e,t=!0){const s=this.drawers.get(e);if(!s||!s.isOpen)return;if(t){this.spa._closeOverlay(`drawer-${e}`,!0);return}s.element.classList.remove("open"),s.element.style.transform="",s.isOpen=!1;const n=`drawer-${e}`,o=this.spa.activeOverlays.indexOf(n);o>-1&&this.spa.activeOverlays.splice(o,1),this.spa.activeOverlays.length===0&&this.spa._hideBackdrop()}_onDragStart(e,t){const s=this.drawers.get(t);s!=null&&s.isOpen&&(this.isDragging=!0,this.currentDrawer=t,this.startX=e.touches[0].clientX,s.element.classList.add("is-dragging"))}_onDragMove(e){if(!this.isDragging||!this.currentDrawer)return;const t=this.drawers.get(this.currentDrawer);if(!t)return;const s=e.touches[0].clientX,n=this.startX-s;n>0&&(e.preventDefault(),t.element.style.transform=`translateX(-${n}px)`)}_onDragEnd(e){if(!this.isDragging||!this.currentDrawer)return;const t=this.drawers.get(this.currentDrawer);if(!t)return;t.element.classList.remove("is-dragging");const s=e.changedTouches[0].clientX;this.startX-s>this.spa.config.gestures.swipeThreshold?this.spa.closeTopOverlay():t.element.style.transform="",this.isDragging=!1,this.currentDrawer=null}}class X{constructor(e){this.spa=e,this.sheets=new Map,this.isDragging=!1,this.startY=0,this.currentSheet=null}register(e){const t=document.getElementById(e);if(t&&(this.sheets.set(e,{element:t,isOpen:!1}),this.spa.config.gestures.enabled)){const s=t.querySelector(".grabber-handle")||t.querySelector(".sheet-header")||t;s.addEventListener("touchstart",n=>this._onDragStart(n,e),{passive:!1}),s.addEventListener("mousedown",n=>this._onDragStart(n,e)),window.addEventListener("touchmove",n=>this._onDragMove(n),{passive:!1}),window.addEventListener("touchend",n=>this._onDragEnd(n)),window.addEventListener("mousemove",n=>this._onDragMove(n)),window.addEventListener("mouseup",n=>this._onDragEnd(n))}}open(e){const t=this.sheets.get(e);!t||t.isOpen||(t.element.classList.add("open"),t.isOpen=!0,this.spa._registerOverlay(`sheet-${e}`))}close(e,t=!0){const s=this.sheets.get(e);if(!s||!s.isOpen)return;if(t){this.spa._closeOverlay(`sheet-${e}`,!0);return}s.element.classList.remove("open"),s.element.style.transform="",s.isOpen=!1;const n=`sheet-${e}`,o=this.spa.activeOverlays.indexOf(n);o>-1&&this.spa.activeOverlays.splice(o,1),this.spa.activeOverlays.length===0&&this.spa._hideBackdrop()}_onDragStart(e,t){const s=this.sheets.get(t);s!=null&&s.isOpen&&(this.isDragging=!0,this.currentSheet=t,this.startY=e.touches?e.touches[0].clientY:e.clientY,s.element.classList.add("is-dragging"))}_onDragMove(e){if(!this.isDragging||!this.currentSheet)return;const t=this.sheets.get(this.currentSheet);if(!t)return;const n=(e.touches?e.touches[0].clientY:e.clientY)-this.startY;n>0&&(e.preventDefault(),t.element.style.transform=`translateY(${n}px)`)}_onDragEnd(e){if(!this.isDragging||!this.currentSheet)return;const t=this.sheets.get(this.currentSheet);if(!t)return;t.element.classList.remove("is-dragging");const n=(e.changedTouches?e.changedTouches[0].clientY:e.clientY)-this.startY,a=t.element.offsetHeight*.3;n>a?this.spa.closeTopOverlay():t.element.style.transform="",this.isDragging=!1,this.currentSheet=null}}class K{constructor(e){this.spa=e,this.modals=new Map,this.counter=0}open(e){return new Promise(t=>{const s=`modal-${++this.counter}`,n=e.dismissible!==!1,o=document.createElement("div");o.className="modal-overlay",o.id=s,o.dataset.dismissible=String(n);const a=document.createElement("div");if(a.className=`modal-dialog ${e.class||""}`,e.width&&(a.style.maxWidth=e.width),e.template){const r=document.getElementById(e.template);r&&(a.innerHTML=r.innerHTML)}else if(e.html){let r="";e.title&&(r+=`<h3 class="modal-title">${e.title}</h3>`),r+=e.html,e.customButtons&&e.customButtons.length>0&&(r+='<div class="modal-actions">',e.customButtons.forEach(c=>{r+=`<button class="${c.class}" data-action="${c.value}">${c.text}</button>`}),r+="</div>"),a.innerHTML=r}else{let r="";e.icon?r+=`<div class="modal-icon">${e.icon}</div>`:e.type==="confirm"?r+='<div class="modal-icon modal-icon-warning">‚ö†Ô∏è</div>':e.type==="success"?r+='<div class="modal-icon modal-icon-success">‚úì</div>':e.type==="error"&&(r+='<div class="modal-icon modal-icon-error">‚úï</div>'),e.title&&(r+=`<h3 class="modal-title">${e.title}</h3>`),e.message&&(r+=`<p class="modal-message">${e.message}</p>`),e.type==="prompt"&&(r+=`<input type="${e.inputType||"text"}" 
                                          class="modal-input input-field" 
                                          placeholder="${e.placeholder||""}"
                                          value="${e.defaultValue||""}">`),r+='<div class="modal-actions">',(e.type==="confirm"||e.type==="prompt")&&(r+=`<button class="btn btn-outline modal-cancel" data-action="cancel">
                                      ${e.cancelText||"Cancelar"}
                                    </button>`),r+=`<button class="btn btn-primary modal-confirm" data-action="confirm">
                                  ${e.confirmText||"OK"}
                                </button>`,r+="</div>",a.innerHTML=r}o.appendChild(a),document.body.appendChild(o),this.modals.set(s,{element:o,resolve:t,dismissible:n}),requestAnimationFrame(()=>{window.lucide&&window.lucide.createIcons()}),requestAnimationFrame(()=>{o.classList.add("show")}),this.spa._registerOverlay(s),o.addEventListener("click",r=>{const c=r.target.dataset.action;if(c)if(e.customButtons)this._resolveAndClose(s,c);else if(c==="confirm"){let d=!0;if(e.type==="prompt"){const l=o.querySelector(".modal-input");d=l?l.value:""}this._resolveAndClose(s,d)}else c==="cancel"&&this._resolveAndClose(s,!1);else r.target===o&&n&&e.closeOnBackdrop!==!1&&this._resolveAndClose(s,null)}),e.type==="prompt"&&setTimeout(()=>{const r=o.querySelector(".modal-input");r&&r.focus()},300)})}close(e){const t=this.modals.get(e);t&&(t.element.classList.remove("show"),setTimeout(()=>{t.element.remove(),this.modals.delete(e)},300))}_resolveAndClose(e,t){const s=this.modals.get(e);if(s){s.resolve(t);try{this.spa._closeOverlay(e,!0)}catch{const o=this.spa.activeOverlays.indexOf(e);o>-1&&this.spa.activeOverlays.splice(o,1),this.close(e),this.spa.activeOverlays.length===0&&this.spa._hideBackdrop()}}}}class be{constructor(e){this.spa=e,this.instances=new Map}register(e){const t=document.getElementById(e);if(!t)return;const s=Array.from(t.querySelectorAll("[data-step]"));this.instances.set(e,{element:t,steps:s,currentStepIndex:0,totalSteps:s.length,formData:{}}),t.addEventListener("click",n=>{const o=n.target.closest("[data-step-action]");if(!o)return;n.preventDefault();const a=o.dataset.stepAction;a==="next"&&this.next(e),a==="prev"&&this.prev(e),a==="finish"&&this.finish(e)}),this._updateView(e,0)}reset(e){const t=this.instances.get(e);if(!t)return;t.element.querySelectorAll("input, select, textarea").forEach(n=>{n.type==="checkbox"||n.type==="radio"?n.checked=!1:n.value=""}),t.formData={},this._updateView(e,0)}next(e){const t=this.instances.get(e);if(!t)return;const s=t.steps[t.currentStepIndex];this._validateStep(s)&&(this._collectStepData(t,s),t.currentStepIndex<t.totalSteps-1&&this._updateView(e,t.currentStepIndex+1))}prev(e){const t=this.instances.get(e);t&&t.currentStepIndex>0&&this._updateView(e,t.currentStepIndex-1)}finish(e){var o,a,r;const t=this.instances.get(e);if(!t)return;const s=t.steps[t.currentStepIndex];if(!this._validateStep(s))return;this._collectStepData(t,s),this.spa.closeSheet(e);const n=new CustomEvent("multistep:finish",{detail:{sheetId:e,data:t.formData}});document.dispatchEvent(n),(r=(a=(o=this.spa)==null?void 0:o.config)==null?void 0:a.debug)!=null&&r.enabled&&console.log("üì¶ MultiStep Data:",t.formData),setTimeout(()=>this.reset(e),500)}_updateView(e,t){const s=this.instances.get(e);if(!s)return;s.currentStepIndex=t,s.steps.forEach((a,r)=>{a.classList.remove("active","prev","next"),r===t?a.classList.add("active"):r<t?a.classList.add("prev"):a.classList.add("next")}),s.element.querySelectorAll(".step-indicator .dot").forEach((a,r)=>{a.classList.toggle("active",r<=t)});const o=s.element.querySelector("[data-step-counter]");o&&(o.textContent=`${t+1}/${s.totalSteps}`)}_collectStepData(e,t){t.querySelectorAll("input, select, textarea").forEach(n=>{if(!n.name)return;if(n.type==="checkbox"){n.checked&&(Array.isArray(e.formData[n.name])||(e.formData[n.name]!==void 0?e.formData[n.name]=[e.formData[n.name]]:e.formData[n.name]=[]),e.formData[n.name].push(n.value||!0));return}let o=n.value;if(n.type==="radio"){if(!n.checked)return;o=n.value}else n.type==="number"&&(o=parseFloat(n.value));e.formData[n.name]!==void 0?(Array.isArray(e.formData[n.name])||(e.formData[n.name]=[e.formData[n.name]]),e.formData[n.name].push(o)):e.formData[n.name]=o})}_validateStep(e){const t=e.querySelectorAll("input, select, textarea");let s=!0;return t.forEach(n=>{n.checkValidity()||(s=!1,n.reportValidity(),n.classList.add("input-error"),n.addEventListener("input",()=>n.classList.remove("input-error"),{once:!0}))}),s}}const Ee={container:null,config:{duration:3e3,position:"bottom-right",maxVisible:3},configure(i){Object.assign(this.config,i)},_ensureContainer(){this.container||(this.container=document.getElementById("toast-container"),this.container||(this.container=document.createElement("div"),this.container.id="toast-container",this.container.className=`toast-container toast-${this.config.position}`,document.body.appendChild(this.container)))},show(i,e="info"){this._ensureContainer();const t=document.createElement("div");t.className=`toast-item toast-${e}`;const s={success:"‚úì",error:"‚úï",warning:"‚ö†",info:"‚Ñπ"};t.innerHTML=`
                <span class="toast-icon">${s[e]||s.info}</span>
                <span class="toast-message">${i}</span>
            `,this.container.appendChild(t);const n=this.container.querySelectorAll(".toast-item");return n.length>this.config.maxVisible&&n[0].remove(),requestAnimationFrame(()=>{t.classList.add("show")}),setTimeout(()=>{t.classList.remove("show"),setTimeout(()=>t.remove(),300)},this.config.duration),t},success(i){return this.show(i,"success")},error(i){return this.show(i,"error")},warning(i){return this.show(i,"warning")},info(i){return this.show(i,"info")}};typeof window<"u"&&(window.DrawerManager=Y,window.SheetManager=X,window.ModalManager=K,window.Toast=Ee);const xe={homePage:"home",pagePrefix:"page-",useHistory:!0,scrollToTop:!0,animation:{type:"fade",speed:.35,backSpeed:.08,easing:"cubic-bezier(0.25, 0.46, 0.45, 0.94)"},gestures:{enabled:!0,swipeBack:!0,swipeThreshold:50,edgeWidth:30,velocityThreshold:.3},ui:{autoTheme:!1,toast:{duration:3e3,position:"bottom-right",maxVisible:3},backdrop:{opacity:.3,blur:12,closeOnClick:!0}},doubleTapExit:!0,doubleTapTimeout:2e3,debug:{enabled:!1,level:1},pwa:{enabled:!0,serviceWorker:"/sw.js",showBanner:!0,bannerDelay:5e3},callbacks:{beforeNavigate:null,afterNavigate:null,onOverlayOpen:null,onOverlayClose:null,onError:null}};class Q{constructor(e={}){this.config=this._deepMerge(xe,e),this.current=this.config.homePage,this.previousPage=null,this.activeOverlays=[],this.lastBackPress=0,this._lastNavigate=0,this.pageHierarchy=new Map,this.pages=new Map,this.backdrop=null,this.toastContainer=null,this.loadingOverlay=null,this.drawerManager=null,this.sheetManager=null,this.modalManager=null,this.db=null,this.storage=null,this.queue=null,this.pwa=null,this.notifications=null,this._online=navigator.onLine,this._handlePopState=this._handlePopState.bind(this),this._handleClick=this._handleClick.bind(this),this._handleOnline=this._handleOnline.bind(this),this._handleOffline=this._handleOffline.bind(this)}async init(){try{return console.log("üöÄ Inicializando SPA Framework..."),this._registerPages(),this._createElements(),this._initManagers(),this._setupEventListeners(),this._setupInitialHistory(),await this._initStorage(),this._applyPreferences(),this._initPWA(),document.documentElement.dataset.animation=this.config.animation.type,document.documentElement.style.setProperty("--spa-animation-speed",this.config.animation.speed+"s"),this.hideLoading(),this._emit("spa:ready",{spa:this}),this._emitPageEvent(this.current,"page:enter"),this._log(1,"‚úÖ SPA Framework inicializado"),this._log(2,`üìä ${this.pageHierarchy.size} p√°ginas registradas`),this}catch(e){throw console.error("‚ùå Erro ao inicializar SPA:",e),e}}go(e,t={}){if(e===this.current)return;const s=Date.now();if(this._lastNavigate&&s-this._lastNavigate<150){this._log(2,"‚è≥ Navega√ß√£o ignorada (debounce)");return}this._lastNavigate=s;const n=this.pages.get(this.current),o=this.pages.get(e);if(!o){console.error(`‚ùå P√°gina n√£o encontrada: ${e}`),this.toastError("‚ùå  ERROR",`P√°gina n√£o encontrada: ${e||"undefined"}`);return}const a=this.pageHierarchy.get(this.current),r=this.pageHierarchy.get(e),c=this._getLevelValue((a==null?void 0:a.level)||"primary"),d=this._getLevelValue((r==null?void 0:r.level)||"primary"),l=e===this.config.homePage;if(l){this.back();return}if(d<c){this.back();return}try{this._prepareBindingsForNavigation(e)}catch{}if(this.config.callbacks.beforeNavigate&&this.config.callbacks.beforeNavigate(this.current,e)===!1)return;const u=t.animation||this.config.animation.type;document.documentElement.style.setProperty("--spa-animation-speed",this.config.animation.speed+"s"),document.documentElement.dataset.animation=u,o.dataset.animBack=u,this._emitPageEvent(this.current,"page:leave"),this._clearPageClasses(n,o),n.classList.add("prev"),o.classList.add("active"),this.previousPage=this.current,this.current=e;const h={page:e,overlays:[],type:(r==null?void 0:r.level)||(l?"home":"primary"),parent:(r==null?void 0:r.parent)||this.config.homePage};t.replaceHistory||d===c&&this.current!==this.config.homePage?history.replaceState(h,"",`#${e}`):history.pushState(h,"",`#${e}`),this.config.scrollToTop&&(o.scrollTop=0),setTimeout(()=>{n.classList.remove("prev"),this._emitPageEvent(e,"page:enter"),this.config.callbacks.afterNavigate&&this.config.callbacks.afterNavigate(this.previousPage,e)},this.config.animation.speed*1e3)}back(e){if(this.activeOverlays.length>0){this.closeTopOverlay();return}let t=null;if(typeof e=="string")t=e;else if(e!=null&&e.target){const s=e.target.closest("[data-back]");if(s){const n=s.dataset.back;n&&n!=="true"&&n!==""&&(t=n)}}if(t){this.go(t);return}history.back()}home(){this.go(this.config.homePage)}openDrawer(e){this.drawerManager&&this.drawerManager.open(e)}closeDrawer(e){this.drawerManager&&this.drawerManager.close(e)}openSheet(e){var t;if(this.sheetManager){const s=document.getElementById(e);if(s&&s.hasAttribute&&s.hasAttribute("data-multistep-sheet"))try{(t=this.multiStepManager)==null||t.reset(e)}catch{}this.sheetManager.open(e)}}closeSheet(e){this.sheetManager&&this.sheetManager.close(e)}async modal(e){return this.modalManager?this.modalManager.open(e):null}closeTopOverlay(){if(this.activeOverlays.length===0)return;const e=this.activeOverlays[this.activeOverlays.length-1];this._closeOverlay(e,!0)}_registerOverlay(e){this.activeOverlays.push(e),this._showBackdrop(),history.pushState({page:this.current,overlays:this.activeOverlays.slice()},"",`#${this.current}_${e}`),this.config.callbacks.onOverlayOpen&&this.config.callbacks.onOverlayOpen(e),this._emit("spa:overlay:open",{id:e})}_closeOverlay(e,t=!0){var n,o,a;const s=this.activeOverlays.indexOf(e);s!==-1&&(this.activeOverlays.splice(s,1),e.startsWith("drawer-")?(n=this.drawerManager)==null||n.close(e.replace("drawer-",""),!1):e.startsWith("sheet-")?(o=this.sheetManager)==null||o.close(e.replace("sheet-",""),!1):e.startsWith("modal-")&&((a=this.modalManager)==null||a.close(e)),this.activeOverlays.length===0&&this._hideBackdrop(),t&&history.back(),this.config.callbacks.onOverlayClose&&this.config.callbacks.onOverlayClose(e),this._emit("spa:overlay:close",{id:e}))}toast(e,t=null,s={}){this.toastContainer||this._createToastContainer();let n;typeof e=="object"?n=e:n={title:e,description:typeof t=="string"?t:null,type:typeof t=="string"&&s.type?s.type:t||"info",duration:(typeof s=="object"?s.duration:s)||4e3,...s};const{title:o,description:a,type:r="info",duration:c=4e3,dismissible:d=!0,progress:l=null,onClose:u=null}=n,h=Math.random().toString(36).substring(2,9),m=document.createElement("div");m.className="toast-item",m.dataset.id=h,m.dataset.type=r,m.dataset.state="closed",m.dataset.dismissible=String(d),l!==null&&(m.dataset.hasProgress="true");const w={success:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>',error:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>',info:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>',warning:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>',loading:'<div class="toast-spinner"></div>',close:'<svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>'};m.innerHTML=`
                <div class="toast-header">
                    <div class="toast-icon">${w[r]||w.info}</div>
                    <div class="toast-content">
                        <div class="toast-title">${o}</div>
                        ${a?`<div class="toast-desc">${a}</div>`:""}
                    </div>
                    <button class="toast-close" aria-label="Fechar">${w.close}</button>
                </div>
                <div class="toast-progress-bg">
                    <div class="toast-progress-fill" style="width: ${l||0}%"></div>
                </div>
            `,this.toastContainer.appendChild(m),this._updateToastStack();const v=this.toastContainer.querySelectorAll(".toast-item:not(.removing)");v.length>this.config.ui.toast.maxVisible&&this._removeToast(v[0]),s.swipeToClose!==!1&&this._setupToastGestures(m,h,u);const x=m.querySelector(".toast-close");return x&&(x.onclick=we=>{we.stopPropagation(),this.dismissToast(h)}),requestAnimationFrame(()=>{m.dataset.state="open",this._updateToastStack()}),d&&c!==1/0&&r!=="loading"&&setTimeout(()=>{this.dismissToast(h)},c),h}updateToast(e,t){var d;const s=(d=this.toastContainer)==null?void 0:d.querySelector(`[data-id="${e}"]`);if(!s)return;const{title:n,description:o,type:a,progress:r,dismissible:c}=t;if(a){s.dataset.type=a;const l={success:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="20 6 9 17 4 12"></polyline></svg>',error:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="15" y1="9" x2="9" y2="15"></line><line x1="9" y1="9" x2="15" y2="15"></line></svg>',info:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>',warning:'<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M10.29 3.86L1.82 18a2 2 0 0 0 1.71 3h16.94a2 2 0 0 0 1.71-3L13.71 3.86a2 2 0 0 0-3.42 0z"></path><line x1="12" y1="9" x2="12" y2="13"></line><line x1="12" y1="17" x2="12.01" y2="17"></line></svg>'},u=s.querySelector(".toast-icon");u&&(u.innerHTML=l[a]||l.info)}if(n){const l=s.querySelector(".toast-title");l&&(l.textContent=n)}if(o!==void 0){let l=s.querySelector(".toast-desc");o&&!l&&(l=document.createElement("div"),l.className="toast-desc",s.querySelector(".toast-content").appendChild(l)),l&&(l.textContent=o)}if(r!==void 0){s.dataset.hasProgress="true";const l=s.querySelector(".toast-progress-fill");l&&(l.style.width=`${r}%`)}c!==void 0&&(s.dataset.dismissible=String(c))}dismissToast(e){var s;const t=(s=this.toastContainer)==null?void 0:s.querySelector(`[data-id="${e}"]`);t&&this._removeToast(t)}toastSuccess(e,t,s={}){return this.toast({title:e,description:t,type:"success",...s})}toastError(e,t,s={}){return this.toast({title:e,description:t,type:"error",...s})}toastWarning(e,t,s={}){return this.toast({title:e,description:t,type:"warning",...s})}toastInfo(e,t,s={}){return this.toast({title:e,description:t,type:"info",...s})}toastLoading(e,t,s={}){return this.toast({title:e,description:t,type:"loading",duration:1/0,dismissible:!1,...s})}_removeToast(e){!e.isConnected||e.classList.contains("removing")||(e.classList.add("removing"),e.classList.remove("show"),setTimeout(()=>{e.remove(),this._updateToastStack()},300))}_updateToastStack(){const e=Array.from(this.toastContainer.querySelectorAll(".toast-item:not(.removing)")),t=e.length,s=this.config.ui.toast.maxVisible,n=document.querySelector(".bottom-nav");n&&getComputedStyle(n).display!=="none"&&!n.classList.contains("hidden")?this.toastContainer.style.transform="translateY(-70px)":this.toastContainer.style.transform="translateY(0)",e.forEach((a,r)=>{if(a.dataset.state==="closed")return;const c=t-1-r;if(c>=s){a.style.opacity="0",a.style.pointerEvents="none";return}const d=r*14,l=1-c*.05,h=this.config.ui.toast.position.startsWith("top")?d:-d;a.style.zIndex=1e3+r,a.style.opacity="1",a.style.transform=`translateY(${h}px) scale(${l})`,a.style.pointerEvents=r===t-1?"auto":"none"})}_setupToastGestures(e,t,s){let n=0,o=0,a=!1;const r=l=>{a=!0,n=l.touches?l.touches[0].clientX:l.clientX,e.style.transition="none"},c=l=>{if(!a)return;l.preventDefault(),o=(l.touches?l.touches[0].clientX:l.clientX)-n,o<0&&(o=0);const u=Math.max(.3,1-o/200);e.style.transform=`translateX(${o}px)`,e.style.opacity=u},d=()=>{a&&(a=!1,e.style.transition="",o>100?(e.style.transform="translateX(100%)",e.style.opacity="0",setTimeout(()=>{s&&s(),this._removeToast(e)},300)):(e.style.transform="",e.style.opacity="",this._updateToastStack()),o=0)};e.addEventListener("mousedown",r),window.addEventListener("mousemove",c),window.addEventListener("mouseup",d),e.addEventListener("touchstart",r,{passive:!1}),e.addEventListener("touchmove",c,{passive:!1}),e.addEventListener("touchend",d)}showLoading(){this.loadingOverlay&&this.loadingOverlay.classList.remove("hidden")}message(e,t="info",s=2e3){const n=document.createElement("div");n.className="message-overlay";const o={success:"‚úì",error:"‚úï",warning:"‚ö†",info:"‚Ñπ"},a={success:"#10b981",error:"#ef4444",warning:"#f59e0b",info:"#3b82f6"};return n.innerHTML=`
                <div class="message-box message-${t}">
                    <div class="message-icon" style="color: ${a[t]}">${o[t]||o.info}</div>
                    <div class="message-text">${e}</div>
                </div>
            `,document.body.appendChild(n),requestAnimationFrame(()=>{n.classList.add("active")}),setTimeout(()=>{n.classList.remove("active"),setTimeout(()=>n.remove(),300)},s),n}hideLoading(){this.loadingOverlay&&this.loadingOverlay.classList.add("hidden")}toggleTheme(){const t=(document.documentElement.dataset.theme||"light")==="light"?"dark":"light";return this.setTheme(t),t}setTheme(e){document.documentElement.dataset.theme=e,this.storage.set("pref_theme",e),window.lucide&&window.lucide.createIcons(),document.querySelectorAll("#theme-toggle-sheet, .theme-toggle").forEach(s=>s.checked=e==="dark"),this._log(2,`üåì Tema alterado para: ${e}`)}setAnimation(e){this.config.animation.type=e,document.documentElement.dataset.animation=e,this.storage.set("pref_animation",e),document.querySelectorAll(".animation-select").forEach(s=>s.value=e),this.toastInfo("Anima√ß√£o Alterada",`Estilo "${e}" aplicado com sucesso.`),this._log(2,`üé¨ Anima√ß√£o alterada para: ${e}`)}_applyPreferences(){const e=this.storage.get("pref_theme");e?this.setTheme(e):this.config.ui.autoTheme&&window.matchMedia&&window.matchMedia("(prefers-color-scheme: dark)").matches&&this.setTheme("dark");const t=this.storage.get("pref_animation");t&&(this.config.animation.type=t,document.documentElement.dataset.animation=t,document.querySelectorAll(".animation-select").forEach(n=>n.value=t)),this._log(2,"‚öôÔ∏è Prefer√™ncias aplicadas")}openModal(e){return this.modal(e)}async logout(){var e;try{this.showLoading();const t=document.createElement("form");t.method="POST",t.action="/logout";const s=(e=document.querySelector('meta[name="csrf-token"]'))==null?void 0:e.content;if(s){const n=document.createElement("input");n.type="hidden",n.name="_token",n.value=s,t.appendChild(n)}document.body.appendChild(t),t.submit()}catch{this.hideLoading(),this.toastError("Erro ao sair","N√£o foi poss√≠vel realizar o logout.")}}get db(){return this._db}set db(e){this._db=e}get storage(){return this._storage}set storage(e){this._storage=e}get queue(){return this._queue}set queue(e){this._queue=e}_registerPages(){document.querySelectorAll(".page").forEach(e=>{let t=e.id;t.startsWith(this.config.pagePrefix)&&(t=t.substring(this.config.pagePrefix.length)),this.pages.set(t,e);const s=e.dataset.level||"primary",n=e.dataset.parent||this.config.homePage,o=e.dataset.keepHistory==="true";this.pageHierarchy.set(t,{level:s,parent:n,keepHistory:o,element:e}),e.classList.contains("active")&&(this.current=t)})}_createElements(){this.backdrop=document.getElementById("backdrop"),this.backdrop||(this.backdrop=document.createElement("div"),this.backdrop.id="backdrop",document.body.appendChild(this.backdrop)),this._createToastContainer(),this.loadingOverlay=document.getElementById("loading-overlay")}_createToastContainer(){this.toastContainer=document.getElementById("toast-container"),this.toastContainer||(this.toastContainer=document.createElement("div"),this.toastContainer.id="toast-container",this.toastContainer.className=`toast-container toast-${this.config.ui.toast.position}`,document.body.appendChild(this.toastContainer))}_initManagers(){this.drawerManager=new Y(this),this.sheetManager=new X(this),this.modalManager=new K(this),this.multiStepManager=new be(this),document.querySelectorAll(".drawer").forEach(e=>{this.drawerManager.register(e.id)}),document.querySelectorAll(".bottom-sheet").forEach(e=>{this.sheetManager.register(e.id)}),document.querySelectorAll("[data-multistep-sheet]").forEach(e=>{this.sheetManager&&this.sheetManager.register(e.id),this.multiStepManager&&this.multiStepManager.register(e.id)}),requestAnimationFrame(()=>{window.lucide&&window.lucide.createIcons()}),console.log("")}_setupEventListeners(){window.addEventListener("popstate",this._handlePopState),document.addEventListener("click",this._handleClick),this.backdrop&&this.config.ui.backdrop.closeOnClick&&this.backdrop.addEventListener("click",()=>{this.activeOverlays.length>0&&this.closeTopOverlay()}),document.addEventListener("keydown",e=>{e.key==="Escape"&&this.activeOverlays.length>0&&this.closeTopOverlay(),e.altKey&&e.key==="ArrowLeft"&&this.back()}),window.addEventListener("online",this._handleOnline),window.addEventListener("offline",this._handleOffline),this.config.doubleTapExit&&window.addEventListener("popstate",this._handleDoubleTapExit.bind(this))}_handleClick(e){const t=e.target,s=t.closest("[data-go]");if(s){e.preventDefault();const d=s.closest(".drawer"),l=s.closest(".bottom-sheet"),u=s.closest(".modal");if(d&&this.drawerManager&&typeof this.drawerManager.close=="function")try{this.drawerManager.close(d.id,!1)}catch{this._closeOverlay(`drawer-${d.id}`,!1)}else if(l&&this.sheetManager&&typeof this.sheetManager.close=="function")try{this.sheetManager.close(l.id,!1)}catch{this._closeOverlay(`sheet-${l.id}`,!1)}else if(u&&this.modalManager&&typeof this.modalManager.close=="function")try{this.modalManager.close(u.id)}catch{this._closeOverlay(`modal-${u.id}`,!1)}this.go(s.dataset.go);return}if(t.closest("[data-back]")){e.preventDefault(),this.back(e);return}const o=t.closest("[data-drawer]");if(o){e.preventDefault(),this.openDrawer(o.dataset.drawer);return}const a=t.closest("[data-sheet]");if(a){e.preventDefault(),this.openSheet(a.dataset.sheet);return}const r=t.closest("[data-modal]");if(r){e.preventDefault();const d=r.dataset.modal;document.getElementById(d)&&this.modal({template:d});return}if(t.closest("[data-close-overlay]")){e.preventDefault(),this.closeTopOverlay();return}}_handlePopState(e){this._log(2,"‚¨ÖÔ∏è Popstate detectado");let t,s=[];if(e.state&&e.state.page)t=e.state.page,s=e.state.overlays||[];else{const c=window.location.hash.slice(1);t=c&&this.pages.has(c)?c:this.config.homePage}if(this._log(2,`‚¨ÖÔ∏è Indo para: ${t}`),s.length<this.activeOverlays.length){const c=this.activeOverlays[this.activeOverlays.length-1];this._closeOverlay(c,!1);return}if(t===this.current)return;const n=this.pages.get(this.current),o=this.pages.get(t);if(!o)return;try{this._prepareBindingsForNavigation(t)}catch{}document.documentElement.dataset.animation=this.config.animation.type;const a=this.config.animation&&this.config.animation.backSpeed||Math.max(this.config.animation.speed/3,.06),r=getComputedStyle(document.documentElement).getPropertyValue("--spa-animation-speed")||this.config.animation.speed+"s";document.documentElement.style.setProperty("--spa-animation-speed",a+"s"),this._emitPageEvent(this.current,"page:leave"),this._clearPageClasses(n,o),n.classList.remove("active"),o.classList.add("revealing"),this.previousPage=this.current,this.current=t,setTimeout(()=>{o.classList.remove("revealing"),o.classList.add("active"),this._emitPageEvent(t,"page:enter"),document.documentElement.style.setProperty("--spa-animation-speed",r.trim()||this.config.animation.speed+"s")},a*1e3)}_handleDoubleTapExit(e){if(!this.config.doubleTapExit)return;const t=e.state;if(t&&t.type==="exit"){const s=Date.now();s-this.lastBackPress<this.config.doubleTapTimeout?window.close():(this.lastBackPress=s,this.toast("Pressione voltar novamente para sair","info"),history.pushState({page:this.current,overlays:[],type:"home"},"",`#${this.current}`))}}_handleOnline(){this._online=!0,this.toast("üåê Conex√£o restaurada","success"),this._emit("spa:online"),this.queue&&this.queue.processAll()}_handleOffline(){this._online=!1,this.toast("üì¥ Voc√™ est√° offline","warning"),this._emit("spa:offline")}get isOnline(){return this._online}_setupInitialHistory(){console.log("SPA: Setting up initial history...");const e=window.location.hash.substring(1);if(e&&this.pages.has(e)&&(this.current=e,this.pages.forEach((s,n)=>{s.classList.toggle("active",n===e)})),console.log({hash:e}),["_modal","_sheet","_drawer"].some(s=>e.includes(s))){const s=e.split(/_(modal|sheet|drawer)/)[0];this.pages.has(s)&&(this.current=s,this.pages.forEach((n,o)=>{n.classList.toggle("active",o===s)}))}if(!history.state||!history.state.page){const s=this.pageHierarchy.get(this.current);history.replaceState({page:this.current,overlays:[],type:(s==null?void 0:s.level)||"home"},"",`#${this.current}`)}}async _initStorage(){try{console.log("SPA: _initStorage starting..."),console.log("SPA: initializing IndexedDBORM..."),this._db=new H("spa_app"),await this._db.init(),console.log("SPA: IndexedDBORM.init() resolved"),this._log(2,"üíæ IndexedDB inicializado"),this._storage=new N("spa_"),this._log(2,"üíæ localStorage inicializado"),console.log("SPA: initializing JobQueue..."),this._queue=new G(this._db),await this._queue.init(),console.log("SPA: JobQueue.init() resolved"),this._log(2,"üìã Job Queue inicializada"),console.log("SPA: _initStorage completed")}catch(e){console.error("Erro ao inicializar storage:",e),this._emit("spa:error",{error:e})}}_initPWA(){this.config.pwa&&this.config.pwa.enabled&&(this.pwa=new U(this,this.config.pwa)),this.notifications=new V(this),typeof this.notifications.init=="function"&&this.notifications.init()}_clearPageClasses(e,t){const s=["active","prev","revealing"];e&&e.classList.remove(...s),t&&t.classList.remove(...s)}_showBackdrop(){this.backdrop&&this.backdrop.classList.add("show")}_hideBackdrop(){this.backdrop&&this.backdrop.classList.remove("show")}_emit(e,t={}){const s=new CustomEvent(e,{detail:t});document.dispatchEvent(s)}_emitPageEvent(e,t){const s=this.pages.get(e);if(s){const n=new CustomEvent(t,{detail:{pageId:e,element:s}});s.dispatchEvent(n),document.dispatchEvent(n)}t==="page:enter"&&this._updatePageBindings()}_getLevelValue(e){const t={home:0,primary:1,secondary:2,tertiary:3};return t[e]!==void 0?t[e]:1}_prepareBindingsForNavigation(e){document.querySelectorAll("[data-show-on]").forEach(t=>{t.dataset.showOn.split(",").map(n=>n.trim()).includes(e)||(t.style.opacity="0",t.style.pointerEvents="none",t.setAttribute("disabled","true"))}),document.querySelectorAll("[data-hide-on]").forEach(t=>{t.dataset.hideOn.split(",").map(n=>n.trim()).includes(e)&&(t.style.opacity="0",t.style.pointerEvents="none",t.setAttribute("disabled","true"))})}_updatePageBindings(){const e=this.current;document.querySelectorAll("[data-show-on]").forEach(t=>{t.dataset.showOn.split(",").map(n=>n.trim()).includes(e)?(t.style.display="",t.style.opacity="",t.style.pointerEvents="",t.removeAttribute("disabled"),t.classList.remove("hidden")):(t.style.display="none",t.classList.add("hidden"))}),document.querySelectorAll("[data-hide-on]").forEach(t=>{t.dataset.hideOn.split(",").map(n=>n.trim()).includes(e)?(t.style.display="none",t.classList.add("hidden")):(t.style.display="",t.style.opacity="",t.style.pointerEvents="",t.removeAttribute("disabled"),t.classList.remove("hidden"))}),document.querySelectorAll("[data-active-on]").forEach(t=>{t.dataset.activeOn.split(",").map(n=>n.trim()).includes(e)?t.classList.add("active"):t.classList.remove("active")}),document.querySelectorAll("[data-go]").forEach(t=>{t.dataset.go===e?t.classList.add("active"):t.classList.remove("active")})}_log(e,t,s=null){this.config.debug.enabled&&(e>this.config.debug.level||(s?console.log(t,s):console.log(t)))}_deepMerge(e,t){const s=Object.assign({},e);return this._isObject(e)&&this._isObject(t)&&Object.keys(t).forEach(n=>{this._isObject(t[n])?n in e?s[n]=this._deepMerge(e[n],t[n]):Object.assign(s,{[n]:t[n]}):Object.assign(s,{[n]:t[n]})}),s}_isObject(e){return e&&typeof e=="object"&&!Array.isArray(e)}destroy(){window.removeEventListener("popstate",this._handlePopState),document.removeEventListener("click",this._handleClick),window.removeEventListener("online",this._handleOnline),window.removeEventListener("offline",this._handleOffline),this.pages.clear(),this.pageHierarchy.clear(),this.activeOverlays=[],this._log(1,"üóëÔ∏è SPA Framework destru√≠do")}}typeof window<"u"&&(window.SPA=Q);function Se(i){const e=document.getElementById("page-home");e&&(e.addEventListener("page:enter",()=>{console.log("üè† Home page entered"),L()}),_e(i))}function L(){const i=document.getElementById("notif-badge");if(!i)return;const e=parseInt(localStorage.getItem("lamarck_notif_count")||"0");e>0?(i.textContent=e>99?"99+":e,i.style.display="flex"):i.style.display="none"}function _e(i){i.storage&&i.storage.watch("lamarck_notif_count",()=>{L()})}function Ie(){const i=parseInt(localStorage.getItem("lamarck_notif_count")||"0");localStorage.setItem("lamarck_notif_count",(i+1).toString()),L(),window.app&&window.app.toastInfo("Nova notifica√ß√£o","Voc√™ tem uma nova mensagem")}function ke(){localStorage.setItem("lamarck_notif_count","0"),L()}window.simulateNotification=Ie;window.clearNotifications=ke;function D(){typeof lucide<"u"&&lucide.createIcons&&lucide.createIcons()}function Z(i){if(!i)return"";const e=i.replace(/\D/g,"");return e.length<=2?`(${e}`:e.length<=7?`(${e.slice(0,2)}) ${e.slice(2)}`:e.length<=11?`(${e.slice(0,2)}) ${e.slice(2,7)}-${e.slice(7)}`:`(${e.slice(0,2)}) ${e.slice(2,7)}-${e.slice(7,11)}`}function ee(i){if(!i)return"";const e=i.replace(/\D/g,"");return e.length<=3?e:e.length<=6?`${e.slice(0,3)}.${e.slice(3)}`:e.length<=9?`${e.slice(0,3)}.${e.slice(3,6)}.${e.slice(6)}`:`${e.slice(0,3)}.${e.slice(3,6)}.${e.slice(6,9)}-${e.slice(9,11)}`}function Le(i){return/^[^\s@]+@[^\s@]+\.[^\s@]+$/.test(i)}let S=1,I=null,g={nome:"",cpf:"",telefone:"",exame:"",pedido:null,data:"",horario:""};function Ae(i){const e=document.getElementById("page-agendamento");e&&e.addEventListener("page:enter",()=>{console.log("üìÖ Agendamento page entered"),Ce(),De(),Ne(),Be(i),Te()})}function Be(i){const e=document.getElementById("btn-upload-pedido"),t=document.getElementById("agend-pedido");e&&t&&(e.addEventListener("click",()=>t.click()),t.addEventListener("change",Pe));const s=document.getElementById("btn-clear-file");s&&s.addEventListener("click",te);const n=document.getElementById("btn-step-2");n&&n.addEventListener("click",()=>j(2));const o=document.getElementById("btn-step-3");o&&o.addEventListener("click",()=>j(3));const a=document.getElementById("btn-back-step-1");a&&a.addEventListener("click",()=>W(1));const r=document.getElementById("btn-back-step-2");r&&r.addEventListener("click",()=>W(2));const c=document.getElementById("btn-submit-agendamento");c&&c.addEventListener("click",()=>Me(i))}function Pe(i){const e=i.target;if(e.files&&e.files[0]){const t=new FileReader;t.onload=s=>{const n=document.getElementById("file-preview"),o=n==null?void 0:n.querySelector("img");o&&(o.src=s.target.result),n==null||n.classList.remove("hidden");const a=document.getElementById("file-label");a&&(a.textContent="Foto anexada ‚úì"),g.pedido=e.files[0]},t.readAsDataURL(e.files[0])}}function te(){const i=document.getElementById("agend-pedido");i&&(i.value="");const e=document.getElementById("file-preview");e&&e.classList.add("hidden");const t=document.getElementById("file-label");t&&(t.textContent="Enviar foto do pedido"),g.pedido=null}function Ce(){S=1,I=null,g={nome:"",cpf:"",telefone:"",exame:"",pedido:null,data:"",horario:""},T(1),["agend-nome","agend-cpf","agend-telefone","agend-exame","agend-data"].forEach(t=>{const s=document.getElementById(t);s&&(s.value="")});const i=document.getElementById("file-preview");i&&i.classList.add("hidden");const e=document.getElementById("file-label");e&&(e.textContent="Enviar foto do pedido")}function De(){const i=document.getElementById("agend-cpf");i&&i.addEventListener("input",t=>{t.target.value=ee(t.target.value)});const e=document.getElementById("agend-telefone");e&&e.addEventListener("input",t=>{t.target.value=Z(t.target.value)})}function Ne(){const i=document.querySelectorAll(".horario-btn");i.forEach(e=>{e.addEventListener("click",()=>{i.forEach(t=>t.classList.remove("btn-primary")),i.forEach(t=>t.classList.add("btn-outline")),e.classList.remove("btn-outline"),e.classList.add("btn-primary"),I=e.dataset.horario,g.horario=I})})}function Te(){const i=document.getElementById("agend-data");if(i){const e=new Date().toISOString().split("T")[0];i.min=e}}function j(i){var t,s,n,o,a;const e=window.app;if(S===1){const r=(t=document.getElementById("agend-nome"))==null?void 0:t.value.trim(),c=(s=document.getElementById("agend-cpf"))==null?void 0:s.value.trim(),d=(n=document.getElementById("agend-telefone"))==null?void 0:n.value.trim();if(!r){e==null||e.toastWarning("Campo obrigat√≥rio","Informe seu nome");return}if(!d||d.length<14){e==null||e.toastWarning("Campo obrigat√≥rio","Informe um telefone v√°lido");return}g.nome=r,g.cpf=c,g.telefone=d,g.exame=((o=document.getElementById("agend-exame"))==null?void 0:o.value)||""}if(S===2){const r=(a=document.getElementById("agend-data"))==null?void 0:a.value;if(!r){e==null||e.toastWarning("Campo obrigat√≥rio","Selecione uma data");return}if(!I){e==null||e.toastWarning("Campo obrigat√≥rio","Selecione um hor√°rio");return}g.data=r,g.horario=I,Oe()}S=i,T(i)}function W(i){S=i,T(i)}function T(i){for(let s=1;s<=3;s++){const n=document.getElementById(`step-${s}`),o=document.getElementById(`form-step-${s}`);n&&(s<i?n.className="w-8 h-8 rounded-full bg-green-500 text-white flex items-center justify-center text-sm font-bold":s===i?n.className="w-8 h-8 rounded-full bg-red-600 text-white flex items-center justify-center text-sm font-bold":n.className="w-8 h-8 rounded-full bg-slate-200 text-slate-500 flex items-center justify-center text-sm font-bold"),o&&o.classList.toggle("hidden",s!==i)}const e=document.getElementById("step-line-1"),t=document.getElementById("step-line-2");e&&(e.className=i>1?"flex-1 h-0.5 bg-green-500 mx-2":"flex-1 h-0.5 bg-slate-200 mx-2"),t&&(t.className=i>2?"flex-1 h-0.5 bg-green-500 mx-2":"flex-1 h-0.5 bg-slate-200 mx-2")}function Oe(){var t,s;const i=((s=(t=document.getElementById("agend-exame"))==null?void 0:t.selectedOptions[0])==null?void 0:s.text)||"N√£o especificado",e=g.data?new Date(g.data+"T12:00:00").toLocaleDateString("pt-BR"):"-";document.getElementById("confirm-nome").textContent=g.nome,document.getElementById("confirm-cpf").textContent=g.cpf||"N√£o informado",document.getElementById("confirm-telefone").textContent=g.telefone,document.getElementById("confirm-exame").textContent=i,document.getElementById("confirm-data").textContent=e,document.getElementById("confirm-horario").textContent=g.horario}async function Me(i){i==null||i.showLoading();try{await new Promise(e=>setTimeout(e,2e3)),i==null||i.hideLoading(),i==null||i.toastSuccess("Agendamento enviado!","Voc√™ receber√° confirma√ß√£o via WhatsApp"),setTimeout(()=>{i==null||i.go("home")},2e3)}catch{i==null||i.hideLoading(),i==null||i.toastError("Erro","N√£o foi poss√≠vel enviar o agendamento")}}window.clearFile=te;let y=[],_=null,p=null;function $e(i){const e=document.getElementById("page-chat");e&&(e.addEventListener("page:enter",()=>{console.log("üí¨ Chat page entered"),qe(),ze(),Ge(),tt(),k()}),e.addEventListener("page:leave",()=>{B()}))}function qe(){const i=localStorage.getItem("lamarck_chat_messages");if(i)try{y=JSON.parse(i),O()}catch{y=[]}y.length===0&&se("Ol√°! üëã Sou a assistente virtual do Laborat√≥rio Lamarck. Como posso ajudar?")}function A(){localStorage.setItem("lamarck_chat_messages",JSON.stringify(y.slice(-50)))}function O(){const i=document.getElementById("chat-messages");if(!i)return;const e=i.querySelector(".bg-yellow-50");i.innerHTML="",e&&i.appendChild(e),y.forEach(t=>{const s=M(t);i.appendChild(s)}),k()}function M(i){const e=document.createElement("div");e.className=`mb-3 flex ${i.type==="sent"?"justify-end":"justify-start"}`,e.dataset.messageId=i.id;const t=document.createElement("div");if(t.className=`message ${i.type==="sent"?"message-sent":"message-received"}`,i.replyTo){const o=document.createElement("div");o.className="message-reply",o.textContent=i.replyTo,t.appendChild(o)}const s=document.createElement("div");s.className="message-content",s.innerHTML=je(i.text),t.appendChild(s);const n=document.createElement("div");if(n.className="message-time",n.textContent=We(i.timestamp),t.appendChild(n),i.reactions&&i.reactions.length>0){const o=document.createElement("div");o.className="message-reactions flex gap-1 mt-2",i.reactions.forEach(a=>{const r=document.createElement("span");r.className="text-sm bg-white/20 px-2 py-0.5 rounded-full",r.textContent=a,o.appendChild(r)}),t.appendChild(o)}return t.addEventListener("contextmenu",o=>F(o,i)),t.addEventListener("long-press",o=>F(o,i)),e.appendChild(t),e}function je(i){const e=/(https?:\/\/[^\s]+)/g;return i.replace(e,'<a href="$1" target="_blank" class="underline">$1</a>')}function We(i){return new Date(i).toLocaleTimeString("pt-BR",{hour:"2-digit",minute:"2-digit"})}function Fe(i){const e={id:Date.now().toString(),type:"sent",text:i,timestamp:Date.now(),replyTo:(_==null?void 0:_.text)||null,reactions:[]};y.push(e),A();const t=document.getElementById("chat-messages");t&&(t.appendChild(M(e)),k()),ne(),setTimeout(()=>Re(i),1e3+Math.random()*1500)}function se(i){const e={id:Date.now().toString(),type:"received",text:i,timestamp:Date.now(),reactions:[]};y.push(e),A();const t=document.getElementById("chat-messages");t&&(t.appendChild(M(e)),k())}function Re(i){const e=i.toLowerCase();let t="";if(e.includes("resultado")||e.includes("exame"))t='Para consultar seus resultados, acesse a se√ß√£o "Resultados" no menu principal ou entre em contato via WhatsApp com seu c√≥digo de acesso. üìã';else if(e.includes("hor√°rio")||e.includes("funcionamento"))t=`üïê Nosso hor√°rio de funcionamento:
‚Ä¢ Segunda a Sexta: 7h √†s 18h
‚Ä¢ S√°bados: 7h √†s 12h
‚Ä¢ Domingos e feriados: Fechado`;else if(e.includes("agendamento")||e.includes("agendar")||e.includes("marcar"))t="Para agendar um exame, voc√™ pode usar nossa op√ß√£o de pr√©-agendamento no app ou entrar em contato via WhatsApp. Quer que eu te direcione? üìÖ";else if(e.includes("conv√™nio")||e.includes("plano"))t='Trabalhamos com os principais conv√™nios: Unimed, Bradesco, SulAm√©rica, Amil, Porto Seguro e outros. Consulte a lista completa na se√ß√£o "Conv√™nios". üí≥';else if(e.includes("preparo")||e.includes("jejum"))t=`O preparo varia de acordo com o exame. Em geral:
‚Ä¢ Hemograma: jejum de 4h
‚Ä¢ Glicemia: jejum de 8-12h
‚Ä¢ Perfil lip√≠dico: jejum de 12h

Consulte "Nossos Exames" para ver o preparo espec√≠fico. üìù`;else if(e.includes("obrigado")||e.includes("valeu")||e.includes("agrade√ßo"))t="Por nada! Estou aqui para ajudar. Se precisar de mais alguma coisa, √© s√≥ perguntar! üòä";else if(e.includes("ol√°")||e.includes("oi")||e.includes("bom dia")||e.includes("boa tarde"))t="Ol√°! Como posso ajudar voc√™ hoje? üôÇ";else{const s=["Entendi! Para informa√ß√µes mais detalhadas, recomendo entrar em contato com nossa equipe via WhatsApp. üì±","Certo! Se precisar de ajuda com agendamentos, resultados ou informa√ß√µes sobre exames, estou √† disposi√ß√£o. üòä","Para garantir que voc√™ receba a melhor orienta√ß√£o, sugiro conversar com nosso atendimento humano via WhatsApp. Posso te direcionar? üí¨"];t=s[Math.floor(Math.random()*s.length)]}se(t)}function ze(){const i=document.getElementById("chat-input");i&&i.addEventListener("input",()=>{i.style.height="auto",i.style.height=Math.min(i.scrollHeight,128)+"px"})}function ie(){const i=document.getElementById("chat-input");if(!i)return;const e=i.value.trim();e&&(Fe(e),i.value="",i.style.height="auto")}function He(i){i.key==="Enter"&&!i.shiftKey&&(i.preventDefault(),ie())}function Je(i){i.style.height="auto",i.style.height=Math.min(i.scrollHeight,128)+"px"}function k(){const i=document.getElementById("chat-messages");i&&setTimeout(()=>{i.scrollTop=i.scrollHeight},100)}function Ge(){document.addEventListener("click",i=>{const e=document.getElementById("message-context-menu");e&&!e.contains(i.target)&&B()})}function F(i,e){var o,a,r,c;i.preventDefault(),p=e;const t=document.getElementById("message-context-menu");if(!t)return;const s=i.clientX||((a=(o=i.touches)==null?void 0:o[0])==null?void 0:a.clientX)||100,n=i.clientY||((c=(r=i.touches)==null?void 0:r[0])==null?void 0:c.clientY)||100;t.style.left=Math.min(s,window.innerWidth-200)+"px",t.style.top=Math.min(n,window.innerHeight-200)+"px",t.classList.remove("hidden")}function B(){const i=document.getElementById("message-context-menu");i&&i.classList.add("hidden"),p=null}function Ue(i){const e=window.app;switch(i){case"reply":p&&(_=p,Ve(p.text));break;case"react":Ze();return;case"copy":p&&(navigator.clipboard.writeText(p.text),e==null||e.toastSuccess("Copiado!","Texto copiado para √°rea de transfer√™ncia"));break;case"delete":p&&Ye(p.id);break}B()}function Ve(i){var s;const e=document.getElementById("reply-preview"),t=document.getElementById("reply-text");e&&t&&(t.textContent=i.substring(0,100)+(i.length>100?"...":""),e.classList.remove("hidden")),(s=document.getElementById("chat-input"))==null||s.focus()}function ne(){_=null;const i=document.getElementById("reply-preview");i&&i.classList.add("hidden")}function Ye(i){var e;y=y.filter(t=>t.id!==i),A(),O(),(e=window.app)==null||e.toastInfo("Mensagem exclu√≠da","")}function Xe(){const i=document.getElementById("emoji-grid");i&&(i.classList.toggle("hidden"),i.classList.contains("hidden")||Ke())}function Ke(){const i=document.getElementById("emoji-grid-content");if(!i)return;const e=["üòÄ","üòÇ","ü•π","üòä","üôÇ","üòâ","üòç","ü•∞","üòò","üòã","ü§î","ü§ó","ü§≠","üòè","üòå","üò¥","ü§í","üò∑","ü§ï","ü§¢","üëç","üëé","üëè","üôè","üí™","‚ù§Ô∏è","üî•","‚≠ê","‚ú®","üíØ","‚úÖ","‚ùå"];i.innerHTML="",e.forEach(t=>{const s=document.createElement("button");s.type="button",s.className="text-2xl p-2 hover:bg-slate-100 rounded-lg transition-colors",s.textContent=t,s.onclick=()=>Qe(t),i.appendChild(s)})}function Qe(i){const e=document.getElementById("chat-input");e&&(e.value+=i,e.focus())}function Ze(){const i=document.getElementById("reaction-picker");if(!i)return;const e=["‚ù§Ô∏è","üëç","üòÇ","üòÆ","üò¢","üôè"];i.innerHTML="",e.forEach(s=>{const n=document.createElement("button");n.className="text-2xl p-2 hover:bg-slate-100 rounded-lg transition-all hover:scale-125",n.textContent=s,n.onclick=()=>et(s),i.appendChild(n)}),i.classList.remove("hidden");const t=document.getElementById("message-context-menu");t&&(i.style.left=t.style.left,i.style.top=parseInt(t.style.top)+t.offsetHeight+8+"px")}function et(i){var e;if(p){const t=y.find(s=>s.id===p.id);t&&(t.reactions||(t.reactions=[]),t.reactions.includes(i)||(t.reactions.push(i),A(),O()))}B(),(e=document.getElementById("reaction-picker"))==null||e.classList.add("hidden")}function tt(){const i=document.getElementById("emoji-grid-close");i&&(i.onclick=()=>{var e;(e=document.getElementById("emoji-grid"))==null||e.classList.add("hidden")})}function st(){const i=window.app;i==null||i.openSheet("chat-options")}function it(){var i;(i=window.app)==null||i.toastInfo("Em breve","Envio de arquivos estar√° dispon√≠vel em breve")}window.sendMessage=ie;window.handleChatKeydown=He;window.autoResizeTextarea=Je;window.scrollToBottom=k;window.contextMenuAction=Ue;window.cancelReply=ne;window.toggleEmojiPicker=Xe;window.toggleChatMenu=st;window.attachFile=it;const oe="lamarck_settings",R={animation:"fade",notifications:{push:!1,email:!0,whatsapp:!1},theme:"light"};function nt(i){const e=document.getElementById("page-configuracoes");e&&e.addEventListener("page:enter",()=>{console.log("‚öôÔ∏è Configura√ß√µes page entered"),at(),ot(i)})}function ot(i){const e=document.getElementById("animation-select");e&&e.addEventListener("change",r=>$(r.target.value));const t=document.getElementById("push-notifications-toggle");t&&t.addEventListener("change",r=>ae(r.target.checked));const s=document.getElementById("email-notifications-toggle");s&&s.addEventListener("change",r=>re(r.target.checked));const n=document.getElementById("whatsapp-notifications-toggle");n&&n.addEventListener("change",r=>ce(r.target.checked));const o=document.getElementById("btn-termos-privacidade");o&&o.addEventListener("click",()=>{i==null||i.openModal("tpl-modal-termo",()=>{setTimeout(()=>{const r=document.getElementById("termo-aceite");r&&(r.checked=!!localStorage.getItem("lamarck_lgpd_accepted"))},100)})});const a=document.getElementById("btn-limpar-dados");a&&a.addEventListener("click",()=>le())}function at(){const i=E(),e=document.getElementById("animation-select");e&&(e.value=i.animation);const t=document.getElementById("push-notifications-toggle"),s=document.getElementById("email-notifications-toggle"),n=document.getElementById("whatsapp-notifications-toggle");t&&(t.checked=i.notifications.push),s&&(s.checked=i.notifications.email),n&&(n.checked=i.notifications.whatsapp)}function E(){const i=localStorage.getItem(oe);return i?{...R,...JSON.parse(i)}:R}function b(i){localStorage.setItem(oe,JSON.stringify(i))}function $(i){const e=window.app,t=E();t.animation=i,b(t),document.documentElement.dataset.animation=i,e!=null&&e.config&&(e.config.animation.type=i),e==null||e.toastSuccess("Anima√ß√£o alterada",`Transi√ß√£o: ${i}`)}async function ae(i){const e=window.app,t=E();if(i){if(e!=null&&e.notifications)if(await e.notifications.request())t.notifications.push=!0,b(t),e==null||e.toastSuccess("Notifica√ß√µes ativadas","Voc√™ receber√° alertas push");else{const n=document.getElementById("push-notifications-toggle");n&&(n.checked=!1),e==null||e.toastWarning("Permiss√£o negada","Habilite nas configura√ß√µes do navegador")}}else t.notifications.push=!1,b(t),e==null||e.toastInfo("Notifica√ß√µes desativadas","")}function re(i){const e=window.app,t=E();t.notifications.email=i,b(t),e==null||e.toastInfo(i?"Email ativado":"Email desativado","")}function ce(i){const e=window.app,t=E();t.notifications.whatsapp=i,b(t),e==null||e.toastInfo(i?"WhatsApp ativado":"WhatsApp desativado","")}async function le(){const i=window.app;if(await(i==null?void 0:i.modal({title:"Limpar Dados",message:"Tem certeza que deseja apagar todos os dados salvos no app? Esta a√ß√£o n√£o pode ser desfeita.",type:"confirm",confirmText:"Sim, limpar",cancelText:"Cancelar",destructive:!0}))){const t=[];for(let s=0;s<localStorage.length;s++){const n=localStorage.key(s);n!=null&&n.startsWith("lamarck_")&&t.push(n)}if(t.forEach(s=>localStorage.removeItem(s)),i!=null&&i.db)try{await i.db.clear()}catch(s){console.error("Erro ao limpar IndexedDB:",s)}i==null||i.toastSuccess("Dados limpos","Todas as prefer√™ncias foram removidas"),setTimeout(()=>location.reload(),1500)}}function rt(){var s;const i=E(),e=i.theme==="light"?"dark":"light";i.theme=e,b(i),document.documentElement.classList.toggle("dark",e==="dark"),document.documentElement.dataset.theme=e;const t=document.getElementById("theme-toggle-sheet");t&&(t.checked=e==="dark"),(s=window.app)==null||s.toastInfo(`Tema ${e==="dark"?"escuro":"claro"} ativado`,"")}function ct(i){$(i)}function lt(){const i=window.app;i==null||i.modal({title:"Sair",message:"Deseja realmente sair da sua conta?",type:"confirm",confirmText:"Sair",cancelText:"Cancelar"}).then(e=>{e&&(window.location.href="/logout")})}window.mudarAnimacao=$;window.toggleNotifications=ae;window.toggleEmailNotifications=re;window.toggleWhatsAppNotifications=ce;window.limparDadosApp=le;window.toggleTheme=rt;window.changeAnimation=ct;window.logout=lt;function dt(i){const e=document.getElementById("page-convenios");e&&e.addEventListener("page:enter",()=>{console.log("üí≥ Conv√™nios page entered")})}function ut(){const i=window.app;i==null||i.openSheet("tpl-sheet-whatsapp")}window.contactAboutInsurance=ut;const ht={hemograma:{title:"Hemograma Completo",alert:"Jejum de 4 horas recomendado",desc:"Exame b√°sico de sangue para avalia√ß√£o geral",items:["Jejum de 4 horas (√°gua liberada)","Trazer documento com foto","Informar medicamentos em uso"]},glicemia:{title:"Glicemia em Jejum",alert:"Jejum de 8 a 12 horas obrigat√≥rio",desc:"Avalia√ß√£o do n√≠vel de a√ß√∫car no sangue",items:["Jejum de 8 a 12 horas","N√£o ingerir bebidas a√ßucaradas","√Ågua liberada","Trazer pedido m√©dico"]},colesterol:{title:"Perfil Lip√≠dico",alert:"Jejum de 12 horas obrigat√≥rio",desc:"Avalia√ß√£o de colesterol e triglicer√≠deos",items:["Jejum de 12 horas obrigat√≥rio","Evitar bebidas alco√≥licas 72h antes","Manter dieta habitual nos dias anteriores","√Ågua liberada"]},tsh:{title:"TSH e T4 Livre",alert:"Sem preparo especial",desc:"Avalia√ß√£o da fun√ß√£o da tireoide",items:["N√£o requer jejum","Informar se usa medica√ß√£o para tireoide","Trazer exames anteriores se tiver"]},eas:{title:"EAS - Urina Tipo I",alert:"Primeira urina da manh√£",desc:"An√°lise b√°sica de urina",items:["Coletar primeira urina da manh√£","Higienizar a regi√£o antes da coleta","Desprezar o primeiro jato","Coletar o jato m√©dio"]},urocultura:{title:"Urocultura",alert:"Jato m√©dio, 4h de reten√ß√£o",desc:"Cultura de urina para identificar bact√©rias",items:["Reten√ß√£o urin√°ria de 4 horas","Higienizar bem a regi√£o","Desprezar primeiro jato","Coletar jato m√©dio em frasco est√©ril"]},testosterona:{title:"Testosterona Total",alert:"Coleta pela manh√£",desc:"Dosagem do horm√¥nio masculino",items:["Coletar entre 7h e 9h da manh√£","Jejum n√£o obrigat√≥rio","Informar uso de suplementos"]},estradiol:{title:"Estradiol",alert:"Informar dia do ciclo menstrual",desc:"Dosagem do horm√¥nio feminino",items:["Informar dia do ciclo menstrual","Jejum n√£o obrigat√≥rio","Informar uso de anticoncepcionais"]},cortisol:{title:"Cortisol",alert:"Coleta entre 7h e 9h da manh√£",desc:"Dosagem do horm√¥nio do estresse",items:["Coleta obrigat√≥ria entre 7h e 9h","Evitar estresse antes da coleta","Jejum n√£o obrigat√≥rio"]},ultrassom:{title:"Ultrassonografia",alert:"Preparo varia por regi√£o",desc:"Exame de imagem por ultrassom",items:["Abdome: jejum de 6-8h, bexiga cheia","P√©lvico: bexiga cheia (1L √°gua 1h antes)","Tireoide: sem preparo","Trazer exames anteriores"]},"raio-x":{title:"Raio-X",alert:"Sem preparo especial",desc:"Exame de imagem por radiografia",items:["N√£o requer preparo especial","Remover objetos met√°licos da regi√£o","Informar se h√° possibilidade de gravidez"]}};function mt(i){const e=document.getElementById("page-exames-lista");e&&e.addEventListener("page:enter",()=>{console.log("üî¨ Exames lista page entered"),gt(),ft()})}function ft(i){const e=document.getElementById("exames-search");e&&e.addEventListener("input",s=>P(s.target.value));const t=document.getElementById("btn-clear-search");t&&t.addEventListener("click",()=>de()),document.querySelectorAll(".exame-item[data-exam]").forEach(s=>{s.addEventListener("click",()=>{const n=s.dataset.exam;ue(n)})})}function gt(){const i=document.getElementById("exames-search");i&&(i.value="",document.querySelectorAll(".exame-categoria").forEach(e=>{e.style.display=""}),document.querySelectorAll(".list-item").forEach(e=>{e.style.display=""}))}function P(i){const e=i.toLowerCase().trim();document.querySelectorAll(".exame-categoria").forEach(s=>{const n=s.querySelectorAll(".list-item");let o=!1;n.forEach(a=>{var l,u;const r=((l=a.querySelector(".list-item-title"))==null?void 0:l.textContent.toLowerCase())||"",c=((u=a.querySelector(".list-item-subtitle"))==null?void 0:u.textContent.toLowerCase())||"",d=r.includes(e)||c.includes(e);a.style.display=d?"":"none",d&&(o=!0)}),s.style.display=o?"":"none"})}function de(){const i=document.getElementById("exames-search");i&&(i.value="",P(""))}function ue(i){const e=window.app,t=ht[i];if(!t){e==null||e.toastWarning("Preparo n√£o encontrado","Consulte nossa equipe via WhatsApp");return}const s=document.getElementById("preparo-title"),n=document.getElementById("preparo-alert"),o=document.getElementById("preparo-desc"),a=document.getElementById("preparo-items");s&&(s.textContent=t.title),n&&(n.textContent=t.alert),o&&(o.textContent=t.desc),a&&(a.innerHTML=t.items.map((r,c)=>`
            <div class="flex items-start gap-3 p-3 bg-slate-50 rounded-xl">
                <div class="w-6 h-6 rounded-full bg-red-100 flex items-center justify-center flex-shrink-0 mt-0.5">
                    <span class="text-xs font-bold text-red-600">${c+1}</span>
                </div>
                <p class="text-slate-700">${r}</p>
            </div>
        `).join("")),e==null||e.openSheet("tpl-sheet-preparo")}function pt(){const i=window.app;document.querySelectorAll('#tpl-sheet-filtro input[type="checkbox"]').forEach(e=>{e.checked=!0}),P(""),i==null||i.toastInfo("Filtros limpos","")}window.filterExams=P;window.clearSearch=de;window.showExamPrep=ue;window.resetFilters=pt;function wt(i){const e=document.getElementById("page-orcamentos");e&&e.addEventListener("page:enter",()=>{console.log("üí∞ Or√ßamentos page entered"),vt(),yt(),he()})}function yt(i){const e=document.getElementById("btn-upload-orcamento"),t=document.getElementById("orc-pedido");e&&t&&(e.addEventListener("click",()=>t.click()),t.addEventListener("change",n=>me(n.target)));const s=document.getElementById("btn-enviar-orcamento");s&&s.addEventListener("click",()=>fe())}function vt(){const i=document.getElementById("orc-telefone");i&&i.addEventListener("input",t=>{t.target.value=Z(t.target.value)});const e=document.getElementById("orc-cpf");e&&e.addEventListener("input",t=>{t.target.value=ee(t.target.value)})}function he(){const i=localStorage.getItem("lamarck_orcamentos");if(i)try{const e=JSON.parse(i);bt(e)}catch(e){console.error("Erro ao carregar or√ßamentos:",e)}}function bt(i){const e=document.getElementById("orcamentos-lista");if(e){if(i.length===0){e.innerHTML=`
            <div class="p-4 text-center text-slate-500">
                <p>Nenhum or√ßamento solicitado ainda</p>
            </div>
        `;return}e.innerHTML=i.slice(0,5).map(t=>{const s=t.status==="respondido"?"bg-green-100 text-green-600":"bg-amber-100 text-amber-600",n=t.status==="respondido"?"check":"clock";return`
            <div class="list-item">
                <div class="list-item-icon ${s}">
                    <i data-lucide="${n}" class="w-5 h-5"></i>
                </div>
                <div class="list-item-content">
                    <p class="list-item-title">Or√ßamento #${t.id}</p>
                    <p class="list-item-subtitle">Enviado em ${t.date} ‚Ä¢ ${t.status==="respondido"?"Respondido":"Aguardando"}</p>
                </div>
                <i data-lucide="chevron-right" class="list-item-action"></i>
            </div>
        `}).join("")}}function me(i){if(i.files&&i.files[0]){const e=new FileReader;e.onload=t=>{const s=document.getElementById("orc-file-preview");s&&(s.querySelector("img").src=t.target.result,s.classList.remove("hidden"));const n=document.getElementById("orc-file-label");n&&(n.textContent="Pedido Anexado ‚úì")},e.readAsDataURL(i.files[0])}}async function fe(){var a,r,c,d,l,u,h;const i=window.app,e=(a=document.getElementById("orc-nome"))==null?void 0:a.value.trim(),t=(r=document.getElementById("orc-telefone"))==null?void 0:r.value.trim(),s=(c=document.getElementById("orc-email"))==null?void 0:c.value.trim();(d=document.getElementById("orc-cpf"))==null||d.value.trim(),(l=document.getElementById("orc-convenio"))==null||l.value;const n=(u=document.getElementById("orc-exames"))==null?void 0:u.value.trim(),o=(h=document.getElementById("orc-pedido"))==null?void 0:h.files[0];if(!e){i==null||i.toastWarning("Campo obrigat√≥rio","Informe seu nome");return}if(!t||t.length<14){i==null||i.toastWarning("Campo obrigat√≥rio","Informe um telefone v√°lido");return}if(!s||!Le(s)){i==null||i.toastWarning("Campo obrigat√≥rio","Informe um email v√°lido");return}if(!n&&!o){i==null||i.toastWarning("Exames n√£o informados","Liste os exames ou envie o pedido m√©dico");return}i==null||i.showLoading();try{await new Promise(v=>setTimeout(v,2e3));const m=JSON.parse(localStorage.getItem("lamarck_orcamentos")||"[]"),w={id:Math.random().toString(36).substring(2,8).toUpperCase(),date:new Date().toLocaleDateString("pt-BR"),status:"pendente",nome:e,email:s,exames:n};m.unshift(w),localStorage.setItem("lamarck_orcamentos",JSON.stringify(m.slice(0,20))),i==null||i.hideLoading(),i==null||i.toastSuccess("Or√ßamento enviado!","Responderemos em at√© 24h"),Et(),he()}catch{i==null||i.hideLoading(),i==null||i.toastError("Erro","N√£o foi poss√≠vel enviar o or√ßamento")}}function Et(){["orc-nome","orc-telefone","orc-email","orc-cpf","orc-exames"].forEach(n=>{const o=document.getElementById(n);o&&(o.value="")});const i=document.getElementById("orc-convenio");i&&(i.selectedIndex=0);const e=document.getElementById("orc-pedido");e&&(e.value="");const t=document.getElementById("orc-file-preview");t&&t.classList.add("hidden");const s=document.getElementById("orc-file-label");s&&(s.textContent="Enviar Pedido M√©dico")}window.handleOrcamentoFile=me;window.enviarOrcamento=fe;function xt(i){const e=document.getElementById("page-resultado");e&&e.addEventListener("page:enter",()=>{console.log("üìã Resultado page entered"),_t(),St()})}function St(i){const e=document.getElementById("btn-abrir-resultado");e&&e.addEventListener("click",()=>ge())}function _t(){const i=localStorage.getItem("lamarck_current_result_code")||"D31B91F2",e="Jo√£o da Silva",t="2 dias √∫teis",s=`https://lamarck.sisvida.com.br/r/${i}`,n=[{name:"Hemograma Completo",realizado:!0},{name:"Glicemia em Jejum",realizado:!0},{name:"Colesterol Total",realizado:!0},{name:"TSH",realizado:!1}],o=document.getElementById("result-patient-name"),a=document.getElementById("result-exam-code"),r=document.getElementById("result-exam-date"),c=document.getElementById("result-patient-name-small"),d=document.getElementById("result-exam-code-small"),l=document.getElementById("result-url"),u=document.getElementById("result-deadline");o&&(o.textContent=e),a&&(a.textContent=`C√≥digo: ${i}`),r&&(r.textContent=`Data: ${new Date().toLocaleDateString("pt-BR")}`),c&&(c.textContent=e),d&&(d.textContent=i),l&&(l.textContent=s,l.href=s),u&&(u.textContent=t),It(n.filter(h=>h.realizado))}function It(i){const e=document.getElementById("result-exams-list");e&&(e.innerHTML=i.map(t=>`
        <div class="list-item">
            <div class="list-item-icon bg-green-100">
                <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" class="text-green-600"><path d="M20 6 9 17l-5-5"/></svg>
            </div>
            <div class="list-item-content">
                <p class="list-item-title">${t.name}</p>
                <p class="list-item-subtitle">Resultado dispon√≠vel</p>
            </div>
        </div>
    `).join(""))}function ge(){var e,t;const i=(e=document.getElementById("result-url"))==null?void 0:e.href;i?window.open(i,"_blank"):(t=window.app)==null||t.toastError("Erro","URL do resultado indispon√≠vel")}function pe(i){localStorage.setItem("lamarck_current_result_code",i)}async function kt(i){const e=window.app;if(!i||i.length<6){e==null||e.toastWarning("C√≥digo inv√°lido","Informe um c√≥digo de acesso v√°lido");return}e==null||e.showLoading();try{await new Promise(t=>setTimeout(t,1500)),pe(i.toUpperCase()),e==null||e.hideLoading(),e==null||e.go("resultado")}catch{e==null||e.hideLoading(),e==null||e.toastError("Erro","N√£o foi poss√≠vel encontrar o resultado")}}window.openResultadoUrl=ge;window.buscarResultado=kt;window.setResultCode=pe;function Lt(i){const e=document.getElementById("btn-toggle-theme"),t=document.getElementById("theme-toggle-sheet");if(e&&t){const o=document.documentElement.dataset.theme||"light";t.checked=o==="dark",e.addEventListener("click",()=>{i.toggleTheme(),t.checked=!t.checked})}document.querySelectorAll(".animation-select").forEach(o=>{o.value=i.config.animation.type,o.addEventListener("change",a=>{const r=a.target.value;i.setAnimation(r)})});const n=document.querySelector('[data-action="logout"]');if(n)n.addEventListener("click",o=>{o.preventDefault(),i.logout()});else{const o=document.getElementById("btn-logout-settings");o&&o.addEventListener("click",()=>i.logout())}At(i)}function At(i){const e=localStorage.getItem("lamarck_lgpd_accepted");if(e&&e!=="null"||window._lgpdInitialized)return;window._lgpdInitialized=!0;let t=!1;const s=()=>{if(t||i.current!=="home")return;!localStorage.getItem("lamarck_lgpd_accepted")&&(t=!0,Bt(i))};document.addEventListener("page:enter",n=>{var a,r,c;(((a=n.detail)==null?void 0:a.pageId)||((c=(r=n.target)==null?void 0:r.id)==null?void 0:c.replace("page-","")))==="home"&&setTimeout(s,2e3)}),i.current==="home"&&setTimeout(s,2e3)}async function Bt(i){if(document.querySelector(".modal-overlay #termo-aceite"))return;const e=t=>{if(!t.target.closest("#btn-aceitar"))return;const n=document.getElementById("termo-aceite");if(!n||!n.checked){t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),i.toast("Voc√™ precisa aceitar os termos para continuar","warning");return}document.removeEventListener("click",e,!0),localStorage.setItem("lamarck_lgpd_accepted",Date.now()),requestAnimationFrame(()=>{i.toast("Bem-vindo ao Laborat√≥rio Lamarck!","success"),i.pwa&&typeof i.pwa.showInstallPrompt=="function"&&(console.log("üöÄ PWA: Agendando prompt para daqui a 15s..."),setTimeout(()=>{localStorage.getItem("lamarck_lgpd_accepted")&&(console.log("üöÄ PWA: Disparando prompt autom√°tico ap√≥s LGPD"),i.pwa.showInstallPrompt())},15e3))})};document.addEventListener("click",e,!0);try{const t=await i.modal({template:"tpl-modal-termo",closeOnBackdrop:!1});document.removeEventListener("click",e,!0)}catch(t){console.error("Erro ao abrir modal LGPD:",t),document.removeEventListener("click",e,!0)}}function Pt(i){Ct(),$t()}function Ct(i){Dt()}function Dt(){var t,s;const i=((t=window.SPA_CONFIG)==null?void 0:t.cities)||["Uberl√¢ndia","Uberaba","Araguari"],e=((s=window.SPA_CONFIG)==null?void 0:s.insurances)||["Unimed","Bradesco","Particular"];z("whatsapp-cities",i,"whatsapp-city"),z("whatsapp-insurances",e,"whatsapp-insurance")}function z(i,e,t){const s=document.getElementById(i);s&&(s.innerHTML="",e.forEach(n=>{const o=document.createElement("button");o.type="button",o.className="px-3 py-1.5 rounded-full border text-sm bg-white hover:bg-slate-50 transition-colors",o.textContent=n,o.dataset.value=n,o.onclick=()=>{Array.from(s.children).forEach(r=>{r.classList.remove("ring-2","ring-red-400","bg-red-50")}),o.classList.add("ring-2","ring-red-400","bg-red-50");const a=document.getElementById(t);a&&(a.value=n)},s.appendChild(o)}))}function Nt(i,e){const t=window.app,s=document.getElementById("whatsapp-topic");s&&(s.value=e);const n=document.getElementById("whatsapp-intent");n&&(n.value=i);const o=document.getElementById("whatsapp-dob-row");o&&(o.style.display=e==="results"?"block":"none"),t==null||t.closeSheet(),setTimeout(()=>{t==null||t.openSheet("tpl-sheet-whatsapp-form")},300)}function Tt(i){let e=i.value.replace(/\D/g,"");e.length>2&&(e=e.slice(0,2)+"/"+e.slice(2)),e.length>5&&(e=e.slice(0,5)+"/"+e.slice(5,9)),i.value=e}function Ot(){var l,u,h,m,w,v,C,x;const i=window.app,e=(l=document.getElementById("whatsapp-name"))==null?void 0:l.value.trim(),t=(u=document.getElementById("whatsapp-city"))==null?void 0:u.value,s=(h=document.getElementById("whatsapp-insurance"))==null?void 0:h.value,n=((m=document.getElementById("whatsapp-intent"))==null?void 0:m.value)||"",o=((w=document.getElementById("whatsapp-topic"))==null?void 0:w.value)||"other",a=(v=document.getElementById("whatsapp-dob"))==null?void 0:v.value;if(!e){i==null||i.toastWarning("Nome obrigat√≥rio","Informe o nome do paciente");return}if(!t){i==null||i.toastWarning("Cidade obrigat√≥ria","Selecione a cidade");return}let r=n;r+=`

*Nome:* ${e}`,r+=`
*Cidade:* ${t}`,s&&(r+=`
*Conv√™nio:* ${s}`),o==="results"&&a&&(r+=`
*Data de Nascimento:* ${a}`);const d=`https://wa.me/${((x=(C=window.SPA_CONFIG)==null?void 0:C.contacts)==null?void 0:x.whatsappNumber)||"5534999999999"}?text=${encodeURIComponent(r)}`;i==null||i.closeSheet(),setTimeout(()=>{window.open(d,"_blank"),i==null||i.toastSuccess("Abrindo WhatsApp...","")},300)}function Mt(i){var n,o;const e=window.app,s=`https://wa.me/${((o=(n=window.SPA_CONFIG)==null?void 0:n.contacts)==null?void 0:o.whatsappNumber)||"5534999999999"}?text=${encodeURIComponent(i)}`;e==null||e.closeSheet(),setTimeout(()=>{window.open(s,"_blank"),e==null||e.toastSuccess("Abrindo WhatsApp...","")},300)}function $t(i){const e=document.getElementById("theme-toggle-sheet");if(e){const s=JSON.parse(localStorage.getItem("lamarck_settings")||"{}");e.checked=s.theme==="dark"}const t=document.querySelector(".animation-select");if(t){const s=JSON.parse(localStorage.getItem("lamarck_settings")||"{}");t.value=s.animation||"fade"}}window.abrirWhatsAppTopic=Nt;window.abrirWhatsApp=Mt;window.maskDob=Tt;window.submitWhatsAppMiddleware=Ot;document.addEventListener("DOMContentLoaded",()=>{window.app=new Q,app.init({homePage:"home",animation:{type:"fade",speed:.35},ui:{autoTheme:!1},pwa:{enabled:!0,showBanner:!1}}),Se(app),Ae(app),$e(app),nt(app),dt(app),mt(app),wt(app),xt(app),Lt(app),Pt(app),D();try{typeof q<"u"&&(window.Html5Qrcode=q)}catch(i){console.warn("Could not expose Html5Qrcode to window",i)}document.addEventListener("spa:page-loaded",i=>{try{D()}catch(e){console.warn("initLucide error",e)}});try{const i=function(){let s;return function(){clearTimeout(s),s=setTimeout(()=>{try{D()}catch{}},120)}}();let e=!1;new MutationObserver(s=>{for(const n of s)if(n.addedNodes&&n.addedNodes.length){for(const o of n.addedNodes)if(o.nodeType===1){if(e)return;if(o.matches&&o.matches("[data-lucide]")){e=!0,i(),setTimeout(()=>e=!1,400);return}if(o.querySelector&&o.querySelector("[data-lucide]")){e=!0,i(),setTimeout(()=>e=!1,400);return}}}}).observe(document.body,{childList:!0,subtree:!0})}catch(i){console.warn("Lucide observer init failed",i)}console.log("üöÄ Lamarck SPA initialized")});
